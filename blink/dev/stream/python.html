<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.5.1 Documentation: Python Programming Guide (Streaming)</title>
    <link rel="shortcut icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/flink.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/syntax.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/codetabs.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      













<div class="sidenav-logo">
  <p><a href="//flink-china.org/doc/blink"><img class="bottom" alt="Apache Flink" src="//flink-china.org/doc/blink/page/img/navbar-brand-logo.jpg"></a> v1.5.1</p>
</div>
<ul id="sidenav">

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-6" data-toggle="collapse"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-6"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse">API Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/datastream_api.html">DataStream API</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-10" data-toggle="collapse">Setup Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-10"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/local_setup.html">Local Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-16" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-16"><ul>
  <li><a href="//flink-china.org/doc/blink/examples/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/examples.html">DataStream Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/examples.html">DataSet Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/stream_sql_quickstart.html">Stream SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/batch_sql_quickstart.html">Batch SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_shell_quickstart.html">Scala Shell Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/zeppelin_quickstart.html">Flink on Zeppelin Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/examples.html">Flink-Hive Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-25" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Project Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-25"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/java_api_quickstart.html">Project Template for Java</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_api_quickstart.html">Project Template for Scala</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/dependencies.html">Configuring Dependencies, Connectors, Libraries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_shell.html">Scala Shell</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-34" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-34"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-35" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-35"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-39" data-toggle="collapse" class="active">Streaming (DataStream API)</a><div class="collapse in" id="collapse-39"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-40" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-40"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-44" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-44"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/state/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/broadcast_state.html">The Broadcast State Pattern</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/custom_serialization.html">Custom Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-52" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-52"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/operators/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-57" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-57"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/connectors/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/python.html" class="active">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/experimental.html">Experimental Features</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-73" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-73"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/batch/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-84" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-84"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/hive_compatibility.html">Hive Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-87" data-toggle="collapse">Streaming Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-87"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/streaming/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/dynamic_tables.html">Dynamic Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/time_attributes.html">Time Attributes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/joins.html">Joins in Continuous Queries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/temporal_tables.html">Temporal Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/match_recognize.html">Detecting Patterns</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sql.html">SQL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/supported_ddl.html">SQL Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sourceSinks.html">Table Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sqlClient.html">SQL Client</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/resource.html">SQL Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/catalog.html">Catalog</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming_optimization.html">Streaming Aggregation Optimization</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/multiple_tablesink_optimization.html">Multiple TableSink Optimization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-106" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-106"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-109" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-116" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-116"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-118" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-118"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/gelly/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-126" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-126"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/ml/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-145" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-145"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-146" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-146"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/hadoop.html">Hadoop Integration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-157" data-toggle="collapse">High Availability (HA) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-157"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_high_availability.html">JobManager High Availability (HA)</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_failover.html">JobManager Failover</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-161" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-161"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/ops/config.html">Configuration</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/cli.html">CLI</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/zeppelin.html">Flink on Zeppelin</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/filesystems.html">File Systems</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-176" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-176"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/logging.html">Logging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_job_resources.html">Debugging Job Resources</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-188" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-188"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/components.html">Component Stack</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/taskmanager_resource.html">TaskManager Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//flink-china.org/doc/blink/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li><a href="//flink-china.org/doc/blink/dev/datastream_api.html">Streaming (DataStream API)</a></li>
  

  
  
    <li class="active">Python API</li>
  

</ol>

<h1>Python Programming Guide (Streaming) <span class="beta">Beta</span></h1>




<p>Analysis streaming programs in Flink are regular programs that implement transformations on
streaming data sets (e.g., filtering, mapping, joining, grouping). The streaming data sets are initially
created from certain sources (e.g., by reading files, or from collections).
Results are returned via sinks, which may for example write the data to (distributed) files, or to
standard output (for example the command line terminal). Flink streaming programs run in a variety
of contexts, standalone, or embedded in other programs. The execution can happen in a local JVM, or
on clusters of many machines.</p>

<p>In order to create your own Flink streaming program, we encourage you to start with the
<a href="#program-skeleton">program skeleton</a> and gradually add your own
<a href="#transformations">transformations</a>. The remaining sections act as references for additional
operations and advanced features.</p>

<ul id="markdown-toc">
  <li><a href="#jython-framework" id="markdown-toc-jython-framework">Jython Framework</a></li>
  <li><a href="#streaming-program-example" id="markdown-toc-streaming-program-example">Streaming Program Example</a></li>
  <li><a href="#program-skeleton" id="markdown-toc-program-skeleton">Program Skeleton</a></li>
  <li><a href="#project-setup" id="markdown-toc-project-setup">Project setup</a></li>
  <li><a href="#lazy-evaluation" id="markdown-toc-lazy-evaluation">Lazy Evaluation</a></li>
  <li><a href="#transformations" id="markdown-toc-transformations">Transformations</a></li>
  <li><a href="#passing-functions-to-flink" id="markdown-toc-passing-functions-to-flink">Passing Functions to Flink</a></li>
  <li><a href="#data-types" id="markdown-toc-data-types">Data Types</a></li>
  <li><a href="#data-sources" id="markdown-toc-data-sources">Data Sources</a></li>
  <li><a href="#data-sinks" id="markdown-toc-data-sinks">Data Sinks</a></li>
  <li><a href="#parallel-execution" id="markdown-toc-parallel-execution">Parallel Execution</a>    <ul>
      <li><a href="#execution-environment-level" id="markdown-toc-execution-environment-level">Execution Environment Level</a></li>
      <li><a href="#system-level" id="markdown-toc-system-level">System Level</a></li>
    </ul>
  </li>
  <li><a href="#executing-plans" id="markdown-toc-executing-plans">Executing Plans</a></li>
</ul>

<h2 id="jython-framework">Jython Framework</h2>
<p>Flink Python streaming API uses Jython framework (see <a href="http://www.jython.org/archive/21/docs/whatis.html">http://www.jython.org/archive/21/docs/whatis.html</a>)
to drive the execution of a given script. The Python streaming layer, is actually a thin wrapper layer for the
existing Java streaming APIs.</p>

<h4 id="constraints">Constraints</h4>
<p>There are two main constraints for using Jython:</p>

<ul>
  <li>The latest Python supported version is 2.7</li>
  <li>It is not straightforward to use Python C extensions</li>
</ul>

<h2 id="streaming-program-example">Streaming Program Example</h2>
<p>The following streaming program is a complete, working example of WordCount. You can copy &amp; paste the code
to run it locally (see notes later in this section). It counts the number of each word (case insensitive)
in a stream of sentences, on a window size of 50 milliseconds and prints the results into the standard output.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">org.apache.flink.streaming.api.functions.source</span> <span class="kn">import</span> <span class="n">SourceFunction</span>
<span class="kn">from</span> <span class="nn">org.apache.flink.api.common.functions</span> <span class="kn">import</span> <span class="n">FlatMapFunction</span><span class="p">,</span> <span class="n">ReduceFunction</span>
<span class="kn">from</span> <span class="nn">org.apache.flink.api.java.functions</span> <span class="kn">import</span> <span class="n">KeySelector</span>
<span class="kn">from</span> <span class="nn">org.apache.flink.streaming.api.windowing.time.Time</span> <span class="kn">import</span> <span class="n">milliseconds</span>


<span class="k">class</span> <span class="nc">Generator</span><span class="p">(</span><span class="n">SourceFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_iters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters</span> <span class="o">=</span> <span class="n">num_iters</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="s">'Hello World'</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="bp">False</span>


<span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="n">FlatMapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">flatMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">collector</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">KeySelector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">ReduceFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="n">count1</span><span class="p">,</span> <span class="n">word1</span> <span class="o">=</span> <span class="n">input1</span>
        <span class="n">count2</span><span class="p">,</span> <span class="n">word2</span> <span class="o">=</span> <span class="n">input2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">count1</span> <span class="o">+</span> <span class="n">count2</span><span class="p">,</span> <span class="n">word1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">factory</span><span class="p">):</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">create_python_source</span><span class="p">(</span><span class="n">Generator</span><span class="p">(</span><span class="n">num_iters</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span> \
        <span class="o">.</span><span class="n">flat_map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span> \
        <span class="o">.</span><span class="n">key_by</span><span class="p">(</span><span class="n">Selector</span><span class="p">())</span> \
        <span class="o">.</span><span class="n">time_window</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span> \
        <span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">Sum</span><span class="p">())</span> \
        <span class="o">.</span><span class="n">output</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span></code></pre></figure>

<p><strong>Notes:</strong></p>

<ul>
  <li>Execution on a multi-node cluster requires a shared medium storage, which needs to be configured (.e.g HDFS)
upfront.</li>
  <li>The output from of the given script is directed to the standard output. Consequently, the output
is written to the corresponding worker <code class="highlighter-rouge">.out</code> file. If the script is executed inside the IntelliJ IDE,
then the output will be displayed in the console tab.</li>
</ul>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="program-skeleton">Program Skeleton</h2>
<p>As we already saw in the example, Flink streaming programs look like regular Python programs.
Each program consists of the same basic parts:</p>

<ol>
  <li>A <code class="highlighter-rouge">main(factory)</code> function definition, with an environment factory argument - the program entry point,</li>
  <li>Obtain an <code class="highlighter-rouge">Environment</code> from the factory,</li>
  <li>Load/create the initial data,</li>
  <li>Specify transformations on this data,</li>
  <li>Specify where to put the results of your computations, and</li>
  <li>Execute your program.</li>
</ol>

<p>We will now give an overview of each of those steps but please refer to the respective sections for
more details.</p>

<p>The <code class="highlighter-rouge">main(factory)</code> function is a must and it is used by Flink execution layer to run the
given Python streaming program.</p>

<p>The <code class="highlighter-rouge">Environment</code> is the basis for all Flink programs. You can
obtain one using the factory methods provided by the factory:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">factory</span><span class="o">.</span><span class="n">get_execution_environment</span><span class="p">()</span></code></pre></figure>

<p>For specifying data sources the streaming execution environment has several methods.
To just read a text file as a sequence of lines, you can use:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">env</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">read_text_file</span><span class="p">(</span><span class="s">"file:///path/to/file"</span><span class="p">)</span></code></pre></figure>

<p>This will give you a DataStream on which you can then apply transformations. For
more information on data sources and input formats, please refer to
<a href="#data-sources">Data Sources</a>.</p>

<p>Once you have a DataStream you can apply transformations to create a new
DataStream which you can then write to a file, transform again, or
combine with other DataStreams. You apply transformations by calling
methods on DataStream with your own custom transformation function. For example,
a map transformation looks like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Doubler</span><span class="p">(</span><span class="n">MapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">data</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">Doubler</span><span class="p">())</span></code></pre></figure>

<p>This will create a new DataStream by doubling every value in the original DataStream.
For more information and a list of all the transformations,
please refer to <a href="#transformations">Transformations</a>.</p>

<p>Once you have a DataStream that needs to be written to disk you can call one
of these methods on DataStream:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span><span class="o">.</span><span class="n">write_as_text</span><span class="p">(</span><span class="s">"&lt;file-path&gt;"</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">write_as_text</span><span class="p">(</span><span class="s">"&lt;file-path&gt;"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WriteMode</span><span class="o">.</span><span class="n">OVERWRITE</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">output</span><span class="p">()</span></code></pre></figure>

<p>The last method is only useful for developing/debugging on a local machine,
it will output the contents of the DataSet to standard output. (Note that in
a cluster, the result goes to the standard out stream of the cluster nodes and ends
up in the <em>.out</em> files of the workers).
The first two do as the name suggests.
Please refer to <a href="#data-sinks">Data Sinks</a> for more information on writing to files.</p>

<p>Once you specified the complete program you need to call <code class="highlighter-rouge">execute</code> on
the <code class="highlighter-rouge">Environment</code>. This will either execute on your local machine or submit your program
for execution on a cluster, depending on how Flink was started.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="project-setup">Project setup</h2>

<p>Apart from setting up Flink, no additional work is required. Using Jython to execute the Python
script, means that no external packages are needed and the program is executed as if it was a jar file.</p>

<p>The Python API was tested on Windows/Linux/OSX systems.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="lazy-evaluation">Lazy Evaluation</h2>

<p>All Flink programs are executed lazily: When the programs main method is executed, the data loading
and transformations do not happen directly. Rather, each operation is created and added to the
programs plan. The operations are actually executed when one of the <code class="highlighter-rouge">execute()</code> methods is invoked
on the Environment object. Whether the program is executed locally or on a cluster depends
on the environment of the program.</p>

<p>The lazy evaluation lets you construct sophisticated programs that Flink executes as one
holistically planned unit.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="transformations">Transformations</h2>

<p>Data transformations transform one or more DataStreams into a new DataStream. Programs can combine
multiple transformations into sophisticated assemblies.</p>

<p>This section gives a brief overview of the available transformations. The <a href="dataset_transformations.html">transformations
documentation</a> has a full description of all transformations with
examples.</p>

<p><br /></p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="text-left" style="width: 20%">Transformation</th>
      <th class="text-center">Description</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td><strong>Map</strong><br />PythonDataStream &rarr; PythonDataStream</td>
      <td>
        <p>Takes one element and produces one element.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Doubler</span><span class="p">(</span><span class="n">MapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">data_stream</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">Doubler</span><span class="p">())</span></code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>FlatMap</strong><br />PythonDataStream &rarr; PythonDataStream</td>
      <td>
        <p>Takes one element and produces zero, one, or more elements. </p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="n">FlatMapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">flatMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">collector</span><span class="p">):</span>
        <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>

<span class="n">data_stream</span><span class="o">.</span><span class="n">flat_map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span></code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>Filter</strong><br />PythonDataStream &rarr; PythonDataStream</td>
      <td>
        <p>Evaluates a boolean function for each element and retains those for which the function
        returns true.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">GreaterThen1000</span><span class="p">(</span><span class="n">FilterFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1000</span>

<span class="n">data_stream</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">GreaterThen1000</span><span class="p">())</span></code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>KeyBy</strong><br />PythonDataStream &rarr; PythonKeyedStream</td>
      <td>
        <p>Logically partitions a stream into disjoint partitions, each partition containing elements of the same key.
        Internally, this is implemented with hash partitioning. See <a href="/dev/api_concepts#specifying-keys">keys</a> on how to specify keys.
        This transformation returns a PythonKeyedDataStream.</p>
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">KeySelector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># Key by the second element in a tuple</span>

<span class="n">data_stream</span><span class="o">.</span><span class="n">key_by</span><span class="p">(</span><span class="n">Selector</span><span class="p">())</span> <span class="o">//</span> <span class="n">Key</span> <span class="n">by</span> <span class="n">field</span> <span class="s">"someKey"</span>
    </code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>Reduce</strong><br />PythonKeyedStream &rarr; PythonDataStream</td>
      <td>
        <p>A "rolling" reduce on a keyed data stream. Combines the current element with the last reduced value and
                        emits the new value.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">ReduceFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="n">count1</span><span class="p">,</span> <span class="n">val1</span> <span class="o">=</span> <span class="n">input1</span>
        <span class="n">count2</span><span class="p">,</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">input2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">count1</span> <span class="o">+</span> <span class="n">count2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">Sum</span><span class="p">())</span></code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>Window</strong><br />PythonKeyedStream &rarr; PythonWindowedStream</td>
      <td>
        <p>Windows can be defined on already partitioned KeyedStreams. Windows group the data in each
        key according to some characteristic (e.g., the data that arrived within the last 5 seconds).
        See <a href="windows.html">windows</a> for a complete description of windows.
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">keyed_stream</span><span class="o">.</span><span class="n">count_window</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c"># Last 10 elements, sliding (jumping) by 5 elements</span>

<span class="n">keyed_stream</span><span class="o">.</span><span class="n">time_window</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>  <span class="c"># Last 30 milliseconds of data</span>

<span class="n">keted_stream</span><span class="o">.</span><span class="n">time_window</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">milliseconds</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c"># Last 100 milliseconds of data, sliding (jumping) by 20 milliseconds</span>
    </code></pre></figure>

        </p>
      </td>
    </tr>

    <tr>
      <td><strong>Window Apply</strong><br />PythonWindowedStream &rarr; PythonDataStream</td>
      <td>
        <p>Applies a general function to the window as a whole. Below is a function that manually sums
           the elements of a window.</p>
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">WindowSum</span><span class="p">(</span><span class="n">WindowFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">collector</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="nb">sum</span><span class="p">))</span>

<span class="n">windowed_stream</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">WindowSum</span><span class="p">())</span>
    </code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>Window Reduce</strong><br />PythonWindowedStream &rarr; PythonDataStream</td>
      <td>
        <p>Applies a functional reduce function to the window and returns the reduced value.</p>
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Sum</span><span class="p">(</span><span class="n">ReduceFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="n">count1</span><span class="p">,</span> <span class="n">val1</span> <span class="o">=</span> <span class="n">input1</span>
        <span class="n">count2</span><span class="p">,</span> <span class="n">val2</span> <span class="o">=</span> <span class="n">input2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">count1</span> <span class="o">+</span> <span class="n">count2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>

<span class="n">windowed_stream</span><span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">Sum</span><span class="p">())</span>
    </code></pre></figure>

      </td>
    </tr>

    <tr>
    <td><strong>Union</strong><br />PythonDataStream* &rarr; PythonDataStream</td>
      <td>
        <p>Union of two or more data streams creating a new stream containing all the elements from all
           the streams. Note: If you union a data stream with itself you will get each element twice
           in the resulting stream.</p>
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data_stream</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">other_stream1</span><span class="p">,</span> <span class="n">other_stream2</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
    </code></pre></figure>

      </td>
    </tr>

    <tr>
      <td><strong>Split</strong><br />PythonDataStream &rarr; PythonSplitStream</td>
      <td>
        <p>Split the stream into two or more streams according to some criterion.
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">StreamSelector</span><span class="p">(</span><span class="n">OutputSelector</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"even"</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[</span><span class="s">"odd"</span><span class="p">]</span>

<span class="n">splited_stream</span> <span class="o">=</span> <span class="n">data_stream</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">StreamSelector</span><span class="p">())</span>
    </code></pre></figure>

        </p>
      </td>
    </tr>

    <tr>
      <td><strong>Select</strong><br />SplitStream &rarr; DataStream</td>
      <td>
        <p> Select one or more streams from a split stream.
    
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">even_data_stream</span> <span class="o">=</span> <span class="n">splited_stream</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"even"</span><span class="p">)</span>
<span class="n">odd_data_stream</span> <span class="o">=</span> <span class="n">splited_stream</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"odd"</span><span class="p">)</span>
<span class="n">all_data_stream</span> <span class="o">=</span> <span class="n">splited_stream</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">"even"</span><span class="p">,</span> <span class="s">"odd"</span><span class="p">)</span>
    </code></pre></figure>

        </p>
      </td>
    </tr>

    <tr>
      <td><strong>Iterate</strong><br />PythonDataStream &rarr; PythonIterativeStream &rarr; PythonDataStream</td>
      <td>
        <p> Creates a "feedback" loop in the flow, by redirecting the output of one operator
            to some previous operator. This is especially useful for defining algorithms that
            continuously update a model. The following code starts with a stream and applies
            the iteration body continuously. Elements that are greater than 0 are sent back
            to the feedback channel, and the rest of the elements are forwarded downstream.
            See <a href="#iterations">iterations</a> for a complete description.
        
<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nf">MinusOne</span><span class="o">(</span><span class="n">MapFunction</span><span class="o">):</span>
    <span class="n">def</span> <span class="nf">map</span><span class="o">(</span><span class="n">self</span><span class="o">,</span> <span class="n">value</span><span class="o">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span>

<span class="kd">class</span> <span class="nf">PositiveNumber</span><span class="o">(</span><span class="n">FilterFunction</span><span class="o">):</span>
    <span class="n">def</span> <span class="nf">filter</span><span class="o">(</span><span class="n">self</span><span class="o">,</span> <span class="n">value</span><span class="o">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="kd">class</span> <span class="nf">LessEquelToZero</span><span class="o">(</span><span class="n">FilterFunction</span><span class="o">):</span>
    <span class="n">def</span> <span class="nf">filter</span><span class="o">(</span><span class="n">self</span><span class="o">,</span> <span class="n">value</span><span class="o">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span>

<span class="n">iteration</span> <span class="o">=</span> <span class="n">initial_stream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
<span class="n">iteration_body</span> <span class="o">=</span> <span class="n">iteration</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">MinusOne</span><span class="o">())</span>
<span class="n">feedback</span> <span class="o">=</span> <span class="n">iteration_body</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">PositiveNumber</span><span class="o">())</span>
<span class="n">iteration</span><span class="o">.</span><span class="na">close_with</span><span class="o">(</span><span class="n">feedback</span><span class="o">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">iteration_body</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">LessEquelToZero</span><span class="o">())</span>
        </code></pre></figure>

        </p>
      </td>
    </tr>

  </tbody>
</table>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="passing-functions-to-flink">Passing Functions to Flink</h2>

<p>Certain operations require user-defined functions as arguments. All the functions should be
defined as Python classes that derived from the relevant Flink function. User-defined functions
are serialized and sent over to the TaskManagers for execution.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="n">FilterFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">5</span>

<span class="n">data_stream</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Filter</span><span class="p">())</span></code></pre></figure>

<p>Rich functions (.e.g <code class="highlighter-rouge">RichFilterFunction</code>) enable to define (override) the optional operations: <code class="highlighter-rouge">open</code> &amp; <code class="highlighter-rouge">close</code>.
The user may use these functions for initialization and cleanups.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="n">RichMapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">data_stream</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span></code></pre></figure>

<p>The <code class="highlighter-rouge">open</code> function is called by the worker before starting the streaming pipeline.
The <code class="highlighter-rouge">close</code> function is called by the worker after the streaming pipeline is stopped.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="data-types">Data Types</h2>

<p>Flinks Python Streaming API offers support for primitive Python types (int, float, bool,
string), as well as byte arrays and user-defined classes.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

<span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="n">MapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Person</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">))</span>

<span class="n">data_stream</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span></code></pre></figure>

<h4 id="tupleslists">Tuples/Lists</h4>

<p>You can use the tuples (or lists) for composite types. Python tuples are mapped to Jython native corresponding
types, which are handled by the Python wrapper thin layer.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">word_counts</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">from_elements</span><span class="p">((</span><span class="s">"hello"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">"world"</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Tokenizer</span><span class="p">(</span><span class="n">MapFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">word_counts</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span></code></pre></figure>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="data-sources">Data Sources</h2>

<p>Data sources create the initial data streams, such as from files or from collections.</p>

<p>File-based:</p>

<ul>
  <li><code class="highlighter-rouge">read_text_file(path)</code> - reads files line wise and returns them as a stream of Strings.</li>
</ul>

<p>Collection-based:</p>

<ul>
  <li><code class="highlighter-rouge">from_elements(*args)</code> - Creates a data stream from all the elements.</li>
  <li><code class="highlighter-rouge">generate_sequence(from, to)</code> - Generates the sequence of numbers in the given interval, in parallel.</li>
</ul>

<p><strong>Examples</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">env</span>  <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">get_execution_environment</span><span class="p">()</span>

\<span class="c"># read text file from local files system</span>
<span class="n">localLiens</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="s">"file:///path/to/my/textfile"</span><span class="p">)</span>

\<span class="c"># read text file from a HDFS running at nnHost:nnPort</span>
<span class="n">hdfsLines</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="s">"hdfs://nnHost:nnPort/path/to/my/textfile"</span><span class="p">)</span>

\<span class="c"># create a set from some given elements</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">from_elements</span><span class="p">(</span><span class="s">"Foo"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">,</span> <span class="s">"foobar"</span><span class="p">,</span> <span class="s">"fubar"</span><span class="p">)</span>

\<span class="c"># generate a number sequence</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">generate_sequence</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">)</span></code></pre></figure>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="data-sinks">Data Sinks</h2>

<p>Data sinks consume DataStreams and are used to store or return them:</p>

<ul>
  <li><code class="highlighter-rouge">write_as_text()</code> - Writes elements line-wise as Strings. The Strings are
obtained by calling the <em>str()</em> method of each element.</li>
  <li><code class="highlighter-rouge">output()</code> - Prints the <em>str()</em> value of each element on the
standard out.</li>
  <li><code class="highlighter-rouge">write_to_socket()</code> - Writes the DataStream to a socket [host:port] as a byte array.</li>
</ul>

<p>A DataStream can be input to multiple operations. Programs can write or print a data stream and at the
same time run additional transformations on them.</p>

<p><strong>Examples</strong></p>

<p>Standard data sink methods:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"> <span class="n">write</span> <span class="nc">DataStream</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span> <span class="n">on</span> <span class="n">the</span> <span class="n">local</span> <span class="n">file</span> <span class="n">system</span>
<span class="n">textData</span><span class="o">.</span><span class="n">write_as_text</span><span class="o">(</span><span class="s">"file:///my/result/on/localFS"</span><span class="o">)</span>

 <span class="n">write</span> <span class="nc">DataStream</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span> <span class="n">on</span> <span class="n">a</span> <span class="nc">HDFS</span> <span class="k">with</span> <span class="n">a</span> <span class="n">namenode</span> <span class="n">running</span> <span class="n">at</span> <span class="n">nnHost</span><span class="k">:</span><span class="kt">nnPort</span>
<span class="n">textData</span><span class="o">.</span><span class="n">write_as_text</span><span class="o">(</span><span class="s">"hdfs://nnHost:nnPort/my/result/on/localFS"</span><span class="o">)</span>

 <span class="n">write</span> <span class="nc">DataStream</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span> <span class="n">and</span> <span class="n">overwrite</span> <span class="n">the</span> <span class="n">file</span> <span class="k">if</span> <span class="n">it</span> <span class="n">exists</span>
<span class="n">textData</span><span class="o">.</span><span class="n">write_as_text</span><span class="o">(</span><span class="s">"file:///my/result/on/localFS"</span><span class="o">,</span> <span class="nc">WriteMode</span><span class="o">.</span><span class="nc">OVERWRITE</span><span class="o">)</span>

 <span class="k">this</span> <span class="n">writes</span> <span class="n">tuples</span> <span class="n">in</span> <span class="n">the</span> <span class="n">text</span> <span class="n">formatting</span> <span class="s">"(a, b, c)"</span><span class="o">,</span> <span class="n">rather</span> <span class="n">than</span> <span class="n">as</span> <span class="nc">CSV</span> <span class="n">lines</span>
<span class="n">values</span><span class="o">.</span><span class="n">write_as_text</span><span class="o">(</span><span class="s">"file:///path/to/the/result/file"</span><span class="o">)</span></code></pre></figure>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="parallel-execution">Parallel Execution</h2>

<p>This section describes how the parallel execution of programs can be configured in Flink. A Flink
program consists of multiple tasks (operators, data sources, and sinks). A task is split into
several parallel instances for execution and each parallel instance processes a subset of the tasks
input data. The number of parallel instances of a task is called its <em>parallelism</em> or <em>degree of
parallelism (DOP)</em>.</p>

<p>The degree of parallelism of a task can be specified in Flink on different levels.</p>

<h3 id="execution-environment-level">Execution Environment Level</h3>

<p>Flink programs are executed in the context of an <a href="#program-skeleton">execution environment</a>. An
execution environment defines a default parallelism for all operators, data sources, and data sinks
it executes. Execution environment parallelism can be overwritten by explicitly configuring the
parallelism of an operator.</p>

<p>The default parallelism of an execution environment can be specified by calling the
<code class="highlighter-rouge">set_parallelism()</code> method. To execute all operators, data sources, and data sinks of the
<a href="#example-program">WordCount</a> example program with a parallelism of <code class="highlighter-rouge">3</code>, set the default parallelism of the
execution environment as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">env</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">get_execution_environment</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">set_parallelism</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">text</span><span class="o">.</span><span class="n">flat_map</span><span class="p">(</span><span class="n">Tokenizer</span><span class="p">())</span> \
    <span class="o">.</span><span class="n">key_by</span><span class="p">(</span><span class="n">Selector</span><span class="p">())</span> \
    <span class="o">.</span><span class="n">time_window</span><span class="p">(</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span> \
    <span class="o">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">Sum</span><span class="p">())</span> \
    <span class="o">.</span><span class="k">print</span><span class="p">()</span>

<span class="n">env</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span></code></pre></figure>

<h3 id="system-level">System Level</h3>

<p>A system-wide default parallelism for all execution environments can be defined by setting the
<code class="highlighter-rouge">parallelism.default</code> property in <code class="highlighter-rouge">./conf/flink-conf.yaml</code>. See the
<a href="//flink-china.org/doc/blink/setup/config.html">Configuration</a> documentation for details.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="executing-plans">Executing Plans</h2>

<p>To run the plan with Flink, go to your Flink distribution, and run the pyflink-stream.sh script from the /bin
folder. The script containing the plan has to be passed as the first argument, followed by a number of additional
Python packages, and finally, separated by <code class="highlighter-rouge">-</code>additional arguments that will be fed to the script.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">pyflink</span><span class="o">-</span><span class="n">stream</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="n">Script</span><span class="o">&gt;</span><span class="p">[</span> <span class="o">&lt;</span><span class="n">pathToPackage1</span><span class="o">&gt;</span><span class="p">[</span> <span class="o">&lt;</span><span class="n">pathToPackageX</span><span class="p">]][</span> <span class="o">-</span> <span class="o">&lt;</span><span class="n">param1</span><span class="o">&gt;</span><span class="p">[</span> <span class="o">&lt;</span><span class="n">paramX</span><span class="o">&gt;</span><span class="p">]]</span></code></pre></figure>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//flink-china.org/doc/blink/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//flink-china.org/doc/blink/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
