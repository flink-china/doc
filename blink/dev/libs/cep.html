<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.5.1 Documentation: FlinkCEP - Complex event processing for Flink</title>
    <link rel="shortcut icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/flink.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/syntax.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/codetabs.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      













<div class="sidenav-logo">
  <p><a href="//flink-china.org/doc/blink"><img class="bottom" alt="Apache Flink" src="//flink-china.org/doc/blink/page/img/navbar-brand-logo.jpg"></a> v1.5.1</p>
</div>
<ul id="sidenav">

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-6" data-toggle="collapse"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-6"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse">API Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/datastream_api.html">DataStream API</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-10" data-toggle="collapse">Setup Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-10"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/local_setup.html">Local Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-16" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-16"><ul>
  <li><a href="//flink-china.org/doc/blink/examples/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/examples.html">DataStream Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/examples.html">DataSet Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/stream_sql_quickstart.html">Stream SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/batch_sql_quickstart.html">Batch SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_shell_quickstart.html">Scala Shell Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/zeppelin_quickstart.html">Flink on Zeppelin Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/examples.html">Flink-Hive Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-25" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Project Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-25"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/java_api_quickstart.html">Project Template for Java</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_api_quickstart.html">Project Template for Scala</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/dependencies.html">Configuring Dependencies, Connectors, Libraries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_shell.html">Scala Shell</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-34" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-34"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-35" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-35"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-39" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-39"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-40" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-40"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-44" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-44"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/state/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/broadcast_state.html">The Broadcast State Pattern</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/custom_serialization.html">Custom Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-52" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-52"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/operators/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-57" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-57"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/connectors/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/experimental.html">Experimental Features</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-73" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-73"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/batch/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-84" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-84"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/hive_compatibility.html">Hive Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-87" data-toggle="collapse">Streaming Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-87"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/streaming/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/dynamic_tables.html">Dynamic Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/time_attributes.html">Time Attributes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/joins.html">Joins in Continuous Queries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/temporal_tables.html">Temporal Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/match_recognize.html">Detecting Patterns</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sql.html">SQL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/supported_ddl.html">SQL Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sourceSinks.html">Table Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sqlClient.html">SQL Client</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/resource.html">SQL Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/catalog.html">Catalog</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming_optimization.html">Streaming Aggregation Optimization</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/multiple_tablesink_optimization.html">Multiple TableSink Optimization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-106" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-106"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-109" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-116" data-toggle="collapse" class="active">Libraries</a><div class="collapse in" id="collapse-116"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/cep.html" class="active">Event Processing (CEP)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-118" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-118"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/gelly/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-126" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-126"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/ml/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-145" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-145"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-146" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-146"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/hadoop.html">Hadoop Integration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-157" data-toggle="collapse">High Availability (HA) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-157"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_high_availability.html">JobManager High Availability (HA)</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_failover.html">JobManager Failover</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-161" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-161"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/ops/config.html">Configuration</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/cli.html">CLI</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/zeppelin.html">Flink on Zeppelin</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/filesystems.html">File Systems</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-176" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-176"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/logging.html">Logging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_job_resources.html">Debugging Job Resources</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-188" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-188"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/components.html">Component Stack</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/taskmanager_resource.html">TaskManager Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//flink-china.org/doc/blink/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li>Libraries</li>
  

  
  
    <li class="active">Event Processing (CEP)</li>
  

</ol>

<h1>FlinkCEP - Complex event processing for Flink</h1>




<p>FlinkCEP is the Complex Event Processing (CEP) library implemented on top of Flink.
It allows you to detect event patterns in an endless stream of events, giving you the opportunity to get hold of what’s important in your
data.</p>

<p>This page describes the API calls available in Flink CEP. We start by presenting the <a href="#the-pattern-api">Pattern API</a>,
which allows you to specify the patterns that you want to detect in your stream, before presenting how you can
<a href="#detecting-patterns">detect and act upon matching event sequences</a>. We then present the assumptions the CEP
library makes when <a href="#handling-lateness-in-event-time">dealing with lateness</a> in event time and how you can
<a href="#migrating-from-an-older-flink-versionpre-13">migrate your job</a> from an older Flink version to Flink-1.3.</p>

<ul id="markdown-toc">
  <li><a href="#getting-started" id="markdown-toc-getting-started">Getting Started</a></li>
  <li><a href="#the-pattern-api" id="markdown-toc-the-pattern-api">The Pattern API</a>    <ul>
      <li><a href="#individual-patterns" id="markdown-toc-individual-patterns">Individual Patterns</a></li>
      <li><a href="#combining-patterns" id="markdown-toc-combining-patterns">Combining Patterns</a></li>
      <li><a href="#after-match-skip-strategy" id="markdown-toc-after-match-skip-strategy">After Match Skip Strategy</a></li>
    </ul>
  </li>
  <li><a href="#detecting-patterns" id="markdown-toc-detecting-patterns">Detecting Patterns</a>    <ul>
      <li><a href="#selecting-from-patterns" id="markdown-toc-selecting-from-patterns">Selecting from Patterns</a></li>
      <li><a href="#handling-timed-out-partial-patterns" id="markdown-toc-handling-timed-out-partial-patterns">Handling Timed Out Partial Patterns</a></li>
    </ul>
  </li>
  <li><a href="#handling-lateness-in-event-time" id="markdown-toc-handling-lateness-in-event-time">Handling Lateness in Event Time</a></li>
  <li><a href="#examples" id="markdown-toc-examples">Examples</a></li>
  <li><a href="#migrating-from-an-older-flink-versionpre-13" id="markdown-toc-migrating-from-an-older-flink-versionpre-13">Migrating from an older Flink version(pre 1.3)</a>    <ul>
      <li><a href="#migrating-to-14" id="markdown-toc-migrating-to-14">Migrating to 1.4+</a></li>
      <li><a href="#migrating-to-13x" id="markdown-toc-migrating-to-13x">Migrating to 1.3.x</a></li>
    </ul>
  </li>
</ul>

<h2 id="getting-started">Getting Started</h2>

<p>If you want to jump right in, <a href="//flink-china.org/doc/blink/dev/linking_with_flink.html">set up a Flink program</a> and
add the FlinkCEP dependency to the <code class="highlighter-rouge">pom.xml</code> of your project.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.alibaba.blink<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-cep_2.11<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.alibaba.blink<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-cep-scala_2.11<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

  </div>
</div>

<p><span class="label label-info">Info</span> FlinkCEP is not part of the binary distribution. See how to link with it for cluster execution <a href="//flink-china.org/doc/blink/dev/linking.html">here</a>.</p>

<p>Now you can start writing your first CEP program using the Pattern API.</p>

<p><span class="label label-danger">Attention</span> The events in the <code class="highlighter-rouge">DataStream</code> to which
you want to apply pattern matching must implement proper <code class="highlighter-rouge">equals()</code> and <code class="highlighter-rouge">hashCode()</code> methods
because FlinkCEP uses them for comparing and matching events.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="mi">42</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">).</span><span class="na">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">subtype</span><span class="o">(</span><span class="n">SubEvent</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">where</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">SubEvent</span> <span class="n">subEvent</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">subEvent</span><span class="o">.</span><span class="na">getVolume</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mf">10.0</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span>
         <span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"end"</span><span class="o">);</span>
            <span class="o">}</span>
         <span class="o">}</span>
    <span class="o">);</span>

<span class="n">PatternStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">patternStream</span> <span class="o">=</span> <span class="n">CEP</span><span class="o">.</span><span class="na">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Alert</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="na">select</span><span class="o">(</span>
    <span class="k">new</span> <span class="n">PatternSelectFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">Alert</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Alert</span> <span class="nf">select</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;&gt;</span> <span class="n">pattern</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">createAlertFrom</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">pattern</span> <span class="k">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getId</span> <span class="o">==</span> <span class="mi">42</span><span class="o">)</span>
  <span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">subtype</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">SubEvent</span><span class="o">]).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getVolume</span> <span class="o">&gt;=</span> <span class="mf">10.0</span><span class="o">)</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span> <span class="o">==</span> <span class="s">"end"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">patternStream</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">)</span>

<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Alert</span><span class="o">]</span> <span class="k">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">createAlert</span><span class="o">(</span><span class="k">_</span><span class="o">))</span></code></pre></figure>

  </div>
</div>

<h2 id="the-pattern-api">The Pattern API</h2>

<p>The pattern API allows you to define complex pattern sequences that you want to extract from your input stream.</p>

<p>Each complex pattern sequence consists of multiple simple patterns, i.e. patterns looking for individual events with the same properties. From now on, we will call these simple patterns <strong>patterns</strong>, and the final complex pattern sequence we are searching for in the stream, the <strong>pattern sequence</strong>. You can see a pattern sequence as a graph of such patterns, where transitions from one pattern to the next occur based on user-specified
<em>conditions</em>, e.g. <code class="highlighter-rouge">event.getName().equals("start")</code>. A <strong>match</strong> is a sequence of input events which visits all
patterns of the complex pattern graph, through a sequence of valid pattern transitions.</p>

<p><span class="label label-danger">Attention</span> Each pattern must have a unique name, which you use later to identify the matched events.</p>

<p><span class="label label-danger">Attention</span> Pattern names <strong>CANNOT</strong> contain the character <code class="highlighter-rouge">":"</code>.</p>

<p>In the rest of this section we will first describe how to define <a href="#individual-patterns">Individual Patterns</a>, and then how you can combine individual patterns into <a href="#combining-patterns">Complex Patterns</a>.</p>

<h3 id="individual-patterns">Individual Patterns</h3>

<p>A <strong>Pattern</strong> can be either a <em>singleton</em> or a <em>looping</em> pattern. Singleton patterns accept a single
event, while looping patterns can accept more than one. In pattern matching symbols, the pattern <code class="highlighter-rouge">"a b+ c? d"</code> (or <code class="highlighter-rouge">"a"</code>, followed by <em>one or more</em> <code class="highlighter-rouge">"b"</code>’s, optionally followed by a <code class="highlighter-rouge">"c"</code>, followed by a <code class="highlighter-rouge">"d"</code>), <code class="highlighter-rouge">a</code>, <code class="highlighter-rouge">c?</code>, and <code class="highlighter-rouge">d</code> are
singleton patterns, while <code class="highlighter-rouge">b+</code> is a looping one. By default, a pattern is a singleton pattern and you can transform
it to a looping one by using <a href="#quantifiers">Quantifiers</a>. Each pattern can have one or more
<a href="#conditions">Conditions</a> based on which it accepts events.</p>

<h4 id="quantifiers">Quantifiers</h4>

<p>In FlinkCEP, you can specify looping patterns using these methods: <code class="highlighter-rouge">pattern.oneOrMore()</code>, for patterns that expect one or more occurrences of a given event (e.g. the <code class="highlighter-rouge">b+</code> mentioned before); and <code class="highlighter-rouge">pattern.times(#ofTimes)</code>, for patterns that
expect a specific number of occurrences of a given type of event, e.g. 4 <code class="highlighter-rouge">a</code>’s; and <code class="highlighter-rouge">pattern.times(#fromTimes, #toTimes)</code>, for patterns that expect a specific minimum number of occurrences and a maximum number of occurrences of a given type of event, e.g. 2-4 <code class="highlighter-rouge">a</code>s.</p>

<p>You can make looping patterns greedy using the <code class="highlighter-rouge">pattern.greedy()</code> method, but you cannot yet make group patterns greedy. You can make all patterns, looping or not, optional using the <code class="highlighter-rouge">pattern.optional()</code> method.</p>

<p>For a pattern named <code class="highlighter-rouge">start</code>, the following are valid quantifiers:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"> <span class="c1">// expecting 4 occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>

 <span class="c1">// expecting 0 or 4 occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">4</span><span class="o">).</span><span class="na">optional</span><span class="o">();</span>

 <span class="c1">// expecting 2, 3 or 4 occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>

 <span class="c1">// expecting 2, 3 or 4 occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="na">greedy</span><span class="o">();</span>

 <span class="c1">// expecting 0, 2, 3 or 4 occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="na">optional</span><span class="o">();</span>

 <span class="c1">// expecting 0, 2, 3 or 4 occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="na">optional</span><span class="o">().</span><span class="na">greedy</span><span class="o">();</span>

 <span class="c1">// expecting 1 or more occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">();</span>

 <span class="c1">// expecting 1 or more occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">greedy</span><span class="o">();</span>

 <span class="c1">// expecting 0 or more occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">optional</span><span class="o">();</span>

 <span class="c1">// expecting 0 or more occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">optional</span><span class="o">().</span><span class="na">greedy</span><span class="o">();</span>

 <span class="c1">// expecting 2 or more occurrences</span>
 <span class="n">start</span><span class="o">.</span><span class="na">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

 <span class="c1">// expecting 2 or more occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">greedy</span><span class="o">();</span>

 <span class="c1">// expecting 0, 2 or more occurrences and repeating as many as possible</span>
 <span class="n">start</span><span class="o">.</span><span class="na">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">optional</span><span class="o">().</span><span class="na">greedy</span><span class="o">();</span>
 </code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"> <span class="c1">// expecting 4 occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>

 <span class="c1">// expecting 0 or 4 occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">4</span><span class="o">).</span><span class="n">optional</span><span class="o">()</span>

 <span class="c1">// expecting 2, 3 or 4 occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>

 <span class="c1">// expecting 2, 3 or 4 occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="n">greedy</span><span class="o">()</span>

 <span class="c1">// expecting 0, 2, 3 or 4 occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="n">optional</span><span class="o">()</span>

 <span class="c1">// expecting 0, 2, 3 or 4 occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">).</span><span class="n">optional</span><span class="o">().</span><span class="n">greedy</span><span class="o">()</span>

 <span class="c1">// expecting 1 or more occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">()</span>

 <span class="c1">// expecting 1 or more occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">greedy</span><span class="o">()</span>

 <span class="c1">// expecting 0 or more occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">optional</span><span class="o">()</span>

 <span class="c1">// expecting 0 or more occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">optional</span><span class="o">().</span><span class="n">greedy</span><span class="o">()</span>

 <span class="c1">// expecting 2 or more occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>

 <span class="c1">// expecting 2 or more occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">greedy</span><span class="o">()</span>

 <span class="c1">// expecting 0, 2 or more occurrences
</span> <span class="n">start</span><span class="o">.</span><span class="n">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">optional</span><span class="o">()</span>

 <span class="c1">// expecting 0, 2 or more occurrences and repeating as many as possible
</span> <span class="n">start</span><span class="o">.</span><span class="n">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">optional</span><span class="o">().</span><span class="n">greedy</span><span class="o">()</span>
 </code></pre></figure>

  </div>
</div>

<h4 id="conditions">Conditions</h4>

<p>At every pattern, and to go from one pattern to the next, you can specify additional <strong>conditions</strong>.
You can relate these conditions to:</p>

<ol>
  <li>
    <p>A <a href="#conditions-on-properties">property of the incoming event</a>, e.g. its value should be larger than 5,
 or larger than the average value of the previously accepted events.</p>
  </li>
  <li>
    <p>The <a href="#conditions-on-contiguity">contiguity of the matching events</a>, e.g. detect pattern <code class="highlighter-rouge">a,b,c</code> without
 non-matching events between any matching ones.</p>
  </li>
</ol>

<p>The latter refers to “looping” patterns, <em>i.e.</em> patterns that can accept more than one event, e.g. the <code class="highlighter-rouge">b+</code> in <code class="highlighter-rouge">a b+ c</code>,
which searches for one or more <code class="highlighter-rouge">b</code>’s.</p>

<h5 id="conditions-on-properties">Conditions on Properties</h5>

<p>You can specify conditions on the event properties via the <code class="highlighter-rouge">pattern.where()</code>, <code class="highlighter-rouge">pattern.or()</code> or the <code class="highlighter-rouge">pattern.until()</code> method. These can be either <code class="highlighter-rouge">IterativeCondition</code>s or <code class="highlighter-rouge">SimpleCondition</code>s.</p>

<p><strong>Iterative Conditions:</strong> This is the most general type of condition. This is how you can specify a condition that
accepts subsequent events based on properties of the previously accepted events or a statistic over a subset of them.</p>

<p>Below is the code for an iterative condition that accepts the next event for a pattern named “middle” if its name starts
with “foo”, and if the sum of the prices of the previously accepted events for that pattern plus the price of the current event do not exceed the value of 5.0. Iterative conditions can be powerful, especially in combination with looping patterns, e.g. <code class="highlighter-rouge">oneOrMore()</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">middle</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">IterativeCondition</span><span class="o">&lt;</span><span class="n">SubEvent</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">SubEvent</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span><span class="o">&lt;</span><span class="n">SubEvent</span><span class="o">&gt;</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kt">double</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Event</span> <span class="n">event</span> <span class="o">:</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getEventsForPattern</span><span class="o">(</span><span class="s">"middle"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">sum</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">middle</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">where</span><span class="o">(</span>
    <span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">ctx</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">lazy</span> <span class="k">val</span> <span class="n">sum</span> <span class="k">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">getEventsForPattern</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">asScala</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getPrice</span><span class="o">).</span><span class="n">sum</span>
        <span class="n">value</span><span class="o">.</span><span class="n">getName</span><span class="o">.</span><span class="n">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">getPrice</span> <span class="o">&lt;</span> <span class="mf">5.0</span>
    <span class="o">}</span>
<span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><span class="label label-danger">Attention</span> The call to <code class="highlighter-rouge">context.getEventsForPattern(...)</code> finds all the
previously accepted events for a given potential match. The cost of this operation can vary, so when implementing
your condition, try to minimize its use.</p>

<p><strong>Simple Conditions:</strong> This type of condition extends the aforementioned <code class="highlighter-rouge">IterativeCondition</code> class and decides
whether to accept an event or not, based <em>only</em> on properties of the event itself.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">start</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">start</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="n">event</span><span class="o">.</span><span class="n">getName</span><span class="o">.</span><span class="n">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span></code></pre></figure>

  </div>
</div>

<p>Finally, you can also restrict the type of the accepted event to a subtype of the initial event type (here <code class="highlighter-rouge">Event</code>)
via the <code class="highlighter-rouge">pattern.subtype(subClass)</code> method.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">start</span><span class="o">.</span><span class="na">subtype</span><span class="o">(</span><span class="n">SubEvent</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">SubEvent</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">SubEvent</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// some condition</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">start</span><span class="o">.</span><span class="n">subtype</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">SubEvent</span><span class="o">]).</span><span class="n">where</span><span class="o">(</span><span class="n">subEvent</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* some condition */</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><strong>Combining Conditions:</strong> As shown above, you can combine the <code class="highlighter-rouge">subtype</code> condition with additional conditions. This holds for every condition. You can arbitrarily combine conditions by sequentially calling <code class="highlighter-rouge">where()</code>. The final result will be the logical <strong>AND</strong> of the results of the individual conditions. To combine conditions using <strong>OR</strong>, you can use the <code class="highlighter-rouge">or()</code> method, as shown below.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// some condition</span>
    <span class="o">}</span>
<span class="o">}).</span><span class="na">or</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// or condition</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* some condition */</span><span class="o">).</span><span class="n">or</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* or condition */</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><strong>Stop condition:</strong> In case of looping patterns (<code class="highlighter-rouge">oneOrMore()</code> and <code class="highlighter-rouge">oneOrMore().optional()</code>) you can
also specify a stop condition, e.g. accept events with value larger than 5 until the sum of values is smaller than 50.</p>

<p>To better understand it, have a look at the following example. Given</p>

<ul>
  <li>
    <p>pattern like <code class="highlighter-rouge">"(a+ until b)"</code> (one or more <code class="highlighter-rouge">"a"</code> until <code class="highlighter-rouge">"b"</code>)</p>
  </li>
  <li>
    <p>a sequence of incoming events <code class="highlighter-rouge">"a1" "c" "a2" "b" "a3"</code></p>
  </li>
  <li>
    <p>the library will output results: <code class="highlighter-rouge">{a1 a2} {a1} {a2} {a3}</code>.</p>
  </li>
</ul>

<p>As you can see <code class="highlighter-rouge">{a1 a2 a3}</code> or <code class="highlighter-rouge">{a2 a3}</code> are not returned due to the stop condition.</p>

<h5 id="conditions-on-contiguity">Conditions on Contiguity</h5>

<p>FlinkCEP supports the following forms of contiguity between events:</p>

<ol>
  <li>
    <p><strong>Strict Contiguity</strong>: Expects all matching events to appear strictly one after the other, without any non-matching events in-between.</p>
  </li>
  <li>
    <p><strong>Relaxed Contiguity</strong>: Ignores non-matching events appearing in-between the matching ones.</p>
  </li>
  <li>
    <p><strong>Non-Deterministic Relaxed Contiguity</strong>: Further relaxes contiguity, allowing additional matches
 that ignore some matching events.</p>
  </li>
</ol>

<p>To illustrate the above with an example, a pattern sequence <code class="highlighter-rouge">"a+ b"</code> (one or more <code class="highlighter-rouge">"a"</code>’s followed by a <code class="highlighter-rouge">"b"</code>) with
input <code class="highlighter-rouge">"a1", "c", "a2", "b"</code> will have the following results:</p>

<ol>
  <li>
    <p><strong>Strict Contiguity</strong>: <code class="highlighter-rouge">{a2 b}</code> – the <code class="highlighter-rouge">"c"</code> after <code class="highlighter-rouge">"a1"</code> causes <code class="highlighter-rouge">"a1"</code> to be discarded.</p>
  </li>
  <li>
    <p><strong>Relaxed Contiguity</strong>: <code class="highlighter-rouge">{a1 b}</code> and <code class="highlighter-rouge">{a1 a2 b}</code> – <code class="highlighter-rouge">"c"</code> is ignored.</p>
  </li>
  <li>
    <p><strong>Non-Deterministic Relaxed Contiguity</strong>: <code class="highlighter-rouge">{a1 b}</code>, <code class="highlighter-rouge">{a2 b}</code>, and <code class="highlighter-rouge">{a1 a2 b}</code>.</p>
  </li>
</ol>

<p>For looping patterns (e.g. <code class="highlighter-rouge">oneOrMore()</code> and <code class="highlighter-rouge">times()</code>) the default is <em>relaxed contiguity</em>. If you want
strict contiguity, you have to explicitly specify it by using the <code class="highlighter-rouge">consecutive()</code> call, and if you want
<em>non-deterministic relaxed contiguity</em> you can use the <code class="highlighter-rouge">allowCombinations()</code> call.</p>

<p><span class="label label-danger">Attention</span>
In this section we are talking about contiguity <em>within</em> a single looping pattern, and the
<code class="highlighter-rouge">consecutive()</code> and <code class="highlighter-rouge">allowCombinations()</code> calls need to be understood in that context. Later when looking at
<a href="#combining-patterns">Combining Patterns</a> we’ll discuss other calls, such as <code class="highlighter-rouge">next()</code> and <code class="highlighter-rouge">followedBy()</code>,
that are used to specify contiguity conditions <em>between</em> patterns.</p>

<div class="codetabs">
  <div data-lang="java">
    <table class="table table-bordered">
    <thead>
        <tr>
            <th class="text-left" style="width: 25%">Pattern Operation</th>
            <th class="text-center">Description</th>
        </tr>
    </thead>
    <tbody>
       <tr>
            <td><strong>where(condition)</strong></td>
            <td>
                <p>Defines a condition for the current pattern. To match the pattern, an event must satisfy the condition.
                 Multiple consecutive where() clauses lead to their conditions being ANDed:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">IterativeCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// some condition</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>or(condition)</strong></td>
            <td>
                <p>Adds a new condition which is ORed with an existing one. An event can match the pattern only if it
                passes at least one of the conditions:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">IterativeCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// some condition</span>
    <span class="o">}</span>
<span class="o">}).</span><span class="na">or</span><span class="o">(</span><span class="k">new</span> <span class="n">IterativeCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// alternative condition</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

                    </td>
       </tr>
              <tr>
                 <td><strong>until(condition)</strong></td>
                 <td>
                     <p>Specifies a stop condition for a looping pattern. Meaning if event matching the given condition occurs, no more
                     events will be accepted into the pattern.</p>
                     <p>Applicable only in conjunction with <code>oneOrMore()</code></p>
                     <p><b>NOTE:</b> It allows for cleaning state for corresponding pattern on event-based condition.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">until</span><span class="o">(</span><span class="k">new</span> <span class="n">IterativeCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1">// alternative condition</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

                 </td>
              </tr>
       <tr>
           <td><strong>subtype(subClass)</strong></td>
           <td>
               <p>Defines a subtype condition for the current pattern. An event can only match the pattern if it is
                of this subtype:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">subtype</span><span class="o">(</span><span class="n">SubEvent</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

           </td>
       </tr>
       <tr>
          <td><strong>oneOrMore()</strong></td>
          <td>
              <p>Specifies that this pattern expects at least one occurrence of a matching event.</p>
              <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
              internal contiguity see <a href="#consecutive_java">consecutive</a>.</p>
              <p><b>NOTE:</b> It is advised to use either <code>until()</code> or <code>within()</code> to enable state clearing</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">();</span></code></pre></figure>

          </td>
       </tr>
           <tr>
              <td><strong>timesOrMore(#times)</strong></td>
              <td>
                  <p>Specifies that this pattern expects at least <strong>#times</strong> occurrences
                  of a matching event.</p>
                  <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
                  internal contiguity see <a href="#consecutive_java">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span></code></pre></figure>

           </td>
       </tr>
       <tr>
          <td><strong>times(#ofTimes)</strong></td>
          <td>
              <p>Specifies that this pattern expects an exact number of occurrences of a matching event.</p>
              <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
              internal contiguity see <a href="#consecutive_java">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>times(#fromTimes, #toTimes)</strong></td>
          <td>
              <p>Specifies that this pattern expects occurrences between <strong>#fromTimes</strong>
              and <strong>#toTimes</strong> of a matching event.</p>
              <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
              internal contiguity see <a href="#consecutive_java">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>optional()</strong></td>
          <td>
              <p>Specifies that this pattern is optional, i.e. it may not occur at all. This is applicable to all
              aforementioned quantifiers.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">optional</span><span class="o">();</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>greedy()</strong></td>
          <td>
              <p>Specifies that this pattern is greedy, i.e. it will repeat as many as possible. This is only applicable
              to quantifiers and it does not support group pattern currently.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">greedy</span><span class="o">();</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>consecutive()</strong><a name="consecutive_java"></a></td>
          <td>
              <p>Works in conjunction with <code>oneOrMore()</code> and <code>times()</code> and imposes strict contiguity between the matching
              events, i.e. any non-matching element breaks the match (as in <code>next()</code>).</p>
              <p>If not applied a relaxed contiguity (as in <code>followedBy()</code>) is used.</p>

              <p>E.g. a pattern like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">})</span>
<span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">consecutive</span><span class="o">()</span>
<span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"end1"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

              <p>Will generate the following matches for an input sequence: C D A1 A2 A3 D A4 B</p>

              <p>with consecutive applied: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}</p>
              <p>without consecutive applied: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}</p>
          </td>
       </tr>
       <tr>
       <td><strong>allowCombinations()</strong><a name="allow_comb_java"></a></td>
       <td>
              <p>Works in conjunction with <code>oneOrMore()</code> and <code>times()</code> and imposes non-deterministic relaxed contiguity
              between the matching events (as in <code>followedByAny()</code>).</p>
              <p>If not applied a relaxed contiguity (as in <code>followedBy()</code>) is used.</p>

              <p>E.g. a pattern like:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">})</span>
<span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}).</span><span class="na">oneOrMore</span><span class="o">().</span><span class="na">allowCombinations</span><span class="o">()</span>
<span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"end1"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

               <p>Will generate the following matches for an input sequence: C D A1 A2 A3 D A4 B</p>

               <p>with combinations enabled: {C A1 B}, {C A1 A2 B}, {C A1 A3 B}, {C A1 A4 B}, {C A1 A2 A3 B}, {C A1 A2 A4 B}, {C A1 A3 A4 B}, {C A1 A2 A3 A4 B}</p>
               <p>without combinations enabled: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}</p>
       </td>
       </tr>
  </tbody>
</table>
  </div>

  <div data-lang="scala">
    <table class="table table-bordered">
    <thead>
        <tr>
            <th class="text-left" style="width: 25%">Pattern Operation</th>
            <th class="text-center">Description</th>
        </tr>
	    </thead>
    <tbody>

        <tr>
            <td><strong>where(condition)</strong></td>
            <td>
              <p>Defines a condition for the current pattern. To match the pattern, an event must satisfy the condition.
                                  Multiple consecutive where() clauses lead to their conditions being ANDed:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* some condition */</span><span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>or(condition)</strong></td>
            <td>
                <p>Adds a new condition which is ORed with an existing one. An event can match the pattern only if it
                passes at least one of the conditions:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* some condition */</span><span class="o">)</span>
    <span class="o">.</span><span class="n">or</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* alternative condition */</span><span class="o">)</span></code></pre></figure>

                    </td>
                </tr>
<tr>
          <td><strong>until(condition)</strong></td>
          <td>
              <p>Specifies a stop condition for looping pattern. Meaning if event matching the given condition occurs, no more
              events will be accepted into the pattern.</p>
              <p>Applicable only in conjunction with <code>oneOrMore()</code></p>
              <p><b>NOTE:</b> It allows for cleaning state for corresponding pattern on event-based condition.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">until</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="cm">/* some condition */</span><span class="o">)</span></code></pre></figure>

          </td>
       </tr>
       <tr>
           <td><strong>subtype(subClass)</strong></td>
           <td>
               <p>Defines a subtype condition for the current pattern. An event can only match the pattern if it is
               of this subtype:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">subtype</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">SubEvent</span><span class="o">])</span></code></pre></figure>

           </td>
       </tr>
       <tr>
          <td><strong>oneOrMore()</strong></td>
          <td>
               <p>Specifies that this pattern expects at least one occurrence of a matching event.</p>
                            <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
                            internal contiguity see <a href="#consecutive_scala">consecutive</a>.</p>
                            <p><b>NOTE:</b> It is advised to use either <code>until()</code> or <code>within()</code> to enable state clearing</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">()</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>timesOrMore(#times)</strong></td>
          <td>
              <p>Specifies that this pattern expects at least <strong>#times</strong> occurrences
              of a matching event.</p>
              <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
              internal contiguity see <a href="#consecutive_scala">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">timesOrMore</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span></code></pre></figure>

           </td>
       </tr>
       <tr>
                 <td><strong>times(#ofTimes)</strong></td>
                 <td>
                     <p>Specifies that this pattern expects an exact number of occurrences of a matching event.</p>
                                   <p>By default a relaxed internal contiguity (between subsequent events) is used.
                                   For more info on internal contiguity see <a href="#consecutive_scala">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span></code></pre></figure>

                 </td>
       </tr>
       <tr>
         <td><strong>times(#fromTimes, #toTimes)</strong></td>
         <td>
             <p>Specifies that this pattern expects occurrences between <strong>#fromTimes</strong>
             and <strong>#toTimes</strong> of a matching event.</p>
             <p>By default a relaxed internal contiguity (between subsequent events) is used. For more info on
             internal contiguity see <a href="#consecutive_java">consecutive</a>.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span></code></pre></figure>

         </td>
       </tr>
       <tr>
          <td><strong>optional()</strong></td>
          <td>
             <p>Specifies that this pattern is optional, i.e. it may not occur at all. This is applicable to all
                           aforementioned quantifiers.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">optional</span><span class="o">()</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>greedy()</strong></td>
          <td>
             <p>Specifies that this pattern is greedy, i.e. it will repeat as many as possible. This is only applicable
             to quantifiers and it does not support group pattern currently.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">greedy</span><span class="o">()</span></code></pre></figure>

          </td>
       </tr>
       <tr>
          <td><strong>consecutive()</strong><a name="consecutive_scala"></a></td>
          <td>
            <p>Works in conjunction with <code>oneOrMore()</code> and <code>times()</code> and imposes strict contiguity between the matching
                          events, i.e. any non-matching element breaks the match (as in <code>next()</code>).</p>
                          <p>If not applied a relaxed contiguity (as in <code>followedBy()</code>) is used.</p>

      <p>E.g. a pattern like:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">))</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">))</span>
                       <span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">consecutive</span><span class="o">()</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"end1"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">))</span></code></pre></figure>


            <p>Will generate the following matches for an input sequence: C D A1 A2 A3 D A4 B</p>

                          <p>with consecutive applied: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}</p>
                          <p>without consecutive applied: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}</p>
          </td>
       </tr>
       <tr>
              <td><strong>allowCombinations()</strong><a name="allow_comb_java"></a></td>
              <td>
                <p>Works in conjunction with <code>oneOrMore()</code> and <code>times()</code> and imposes non-deterministic relaxed contiguity
                     between the matching events (as in <code>followedByAny()</code>).</p>
                     <p>If not applied a relaxed contiguity (as in <code>followedBy()</code>) is used.</p>

      <p>E.g. a pattern like:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">))</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">))</span>
                       <span class="o">.</span><span class="n">oneOrMore</span><span class="o">().</span><span class="n">allowCombinations</span><span class="o">()</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"end1"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span><span class="o">().</span><span class="n">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">))</span></code></pre></figure>


                      <p>Will generate the following matches for an input sequence: C D A1 A2 A3 D A4 B</p>

                      <p>with combinations enabled: {C A1 B}, {C A1 A2 B}, {C A1 A3 B}, {C A1 A4 B}, {C A1 A2 A3 B}, {C A1 A2 A4 B}, {C A1 A3 A4 B}, {C A1 A2 A3 A4 B}</p>
                      <p>without combinations enabled: {C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}</p>
              </td>
              </tr>
  </tbody>
</table>
  </div>

</div>

<h3 id="combining-patterns">Combining Patterns</h3>

<p>Now that you’ve seen what an individual pattern can look like, it is time to see how to combine them
into a full pattern sequence.</p>

<p>A pattern sequence has to start with an initial pattern, as shown below:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">start</span> <span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>Next, you can append more patterns to your pattern sequence by specifying the desired <em>contiguity conditions</em> between
them. In the <a href="#conditions-on-contiguity">previous section</a> we described the different contiguity modes supported by
Flink, namely <em>strict</em>, <em>relaxed</em>, and <em>non-deterministic relaxed</em>, and how to apply them in looping patterns. To apply
them between consecutive patterns, you can use:</p>

<ol>
  <li><code class="highlighter-rouge">next()</code>, for <em>strict</em>,</li>
  <li><code class="highlighter-rouge">followedBy()</code>, for <em>relaxed</em>, and</li>
  <li><code class="highlighter-rouge">followedByAny()</code>, for <em>non-deterministic relaxed</em> contiguity.</li>
</ol>

<p>or</p>

<ol>
  <li><code class="highlighter-rouge">notNext()</code>, if you do not want an event type to directly follow another</li>
  <li><code class="highlighter-rouge">notFollowedBy()</code>, if you do not want an event type to be anywhere between two other event types.</li>
</ol>

<p><span class="label label-danger">Attention</span> A pattern sequence cannot end in <code class="highlighter-rouge">notFollowedBy()</code>.</p>

<p><span class="label label-danger">Attention</span> A <code class="highlighter-rouge">NOT</code> pattern cannot be preceded by an optional one.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// strict contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">strict</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...);</span>

<span class="c1">// relaxed contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">relaxed</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...);</span>

<span class="c1">// non-deterministic relaxed contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">nonDetermin</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedByAny</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...);</span>

<span class="c1">// NOT pattern with strict contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">strictNot</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">notNext</span><span class="o">(</span><span class="s">"not"</span><span class="o">).</span><span class="na">where</span><span class="o">(...);</span>

<span class="c1">// NOT pattern with relaxed contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">relaxedNot</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">notFollowedBy</span><span class="o">(</span><span class="s">"not"</span><span class="o">).</span><span class="na">where</span><span class="o">(...);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// strict contiguity
</span><span class="k">val</span> <span class="n">strict</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>

<span class="c1">// relaxed contiguity
</span><span class="k">val</span> <span class="n">relaxed</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>

<span class="c1">// non-deterministic relaxed contiguity
</span><span class="k">val</span> <span class="n">nonDetermin</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedByAny</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>

<span class="c1">// NOT pattern with strict contiguity
</span><span class="k">val</span> <span class="n">strictNot</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">notNext</span><span class="o">(</span><span class="s">"not"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>

<span class="c1">// NOT pattern with relaxed contiguity
</span><span class="k">val</span> <span class="n">relaxedNot</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">notFollowedBy</span><span class="o">(</span><span class="s">"not"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span></code></pre></figure>

  </div>
</div>

<p>Relaxed contiguity means that only the first succeeding matching event will be matched, while
with non-deterministic relaxed contiguity, multiple matches will be emitted for the same beginning. As an example,
a pattern <code class="highlighter-rouge">"a b"</code>, given the event sequence <code class="highlighter-rouge">"a", "c", "b1", "b2"</code>, will give the following results:</p>

<ol>
  <li>
    <p>Strict Contiguity between <code class="highlighter-rouge">"a"</code> and <code class="highlighter-rouge">"b"</code>: <code class="highlighter-rouge">{}</code> (no match), the <code class="highlighter-rouge">"c"</code> after <code class="highlighter-rouge">"a"</code> causes <code class="highlighter-rouge">"a"</code> to be discarded.</p>
  </li>
  <li>
    <p>Relaxed Contiguity between <code class="highlighter-rouge">"a"</code> and <code class="highlighter-rouge">"b"</code>: <code class="highlighter-rouge">{a b1}</code>, as relaxed continuity is viewed as “skip non-matching events
till the next matching one”.</p>
  </li>
  <li>
    <p>Non-Deterministic Relaxed Contiguity between <code class="highlighter-rouge">"a"</code> and <code class="highlighter-rouge">"b"</code>: <code class="highlighter-rouge">{a b1}</code>, <code class="highlighter-rouge">{a b2}</code>, as this is the most general form.</p>
  </li>
</ol>

<p>It’s also possible to define a temporal constraint for the pattern to be valid.
For example, you can define that a pattern should occur within 10 seconds via the <code class="highlighter-rouge">pattern.within()</code> method.
Temporal patterns are supported for both <a href="//flink-china.org/doc/blink/dev/event_time.html">processing and event time</a>.</p>

<p><span class="label label-danger">Attention</span> A pattern sequence can only have one temporal constraint. If multiple such constraints are defined on different individual patterns, then the smallest is applied.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">next</span><span class="o">.</span><span class="na">within</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">next</span><span class="o">.</span><span class="n">within</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span></code></pre></figure>

  </div>
</div>

<p>It’s also possible to define a pattern sequence as the condition for <code class="highlighter-rouge">begin</code>, <code class="highlighter-rouge">followedBy</code>, <code class="highlighter-rouge">followedByAny</code> and
<code class="highlighter-rouge">next</code>. The pattern sequence will be considered as the matching condition logically and a <code class="highlighter-rouge">GroupPattern</code> will be
returned and it is possible to apply <code class="highlighter-rouge">oneOrMore()</code>, <code class="highlighter-rouge">times(#ofTimes)</code>, <code class="highlighter-rouge">times(#fromTimes, #toTimes)</code>, <code class="highlighter-rouge">optional()</code>,
<code class="highlighter-rouge">consecutive()</code>, <code class="highlighter-rouge">allowCombinations()</code> to the <code class="highlighter-rouge">GroupPattern</code>.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">begin</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"start_middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">);</span>

<span class="c1">// strict contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">strict</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">next</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"next_start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"next_middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="na">times</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

<span class="c1">// relaxed contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">relaxed</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedBy</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"followedby_start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"followedby_middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="na">oneOrMore</span><span class="o">();</span>

<span class="c1">// non-deterministic relaxed contiguity</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">nonDetermin</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedByAny</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"followedbyany_start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"followedbyany_middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="na">optional</span><span class="o">();</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">start</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">](</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"start_middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">)</span>

<span class="c1">// strict contiguity
</span><span class="k">val</span> <span class="n">strict</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">next</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">](</span><span class="s">"next_start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"next_middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="n">times</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

<span class="c1">// relaxed contiguity
</span><span class="k">val</span> <span class="n">relaxed</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedBy</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">](</span><span class="s">"followedby_start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"followedby_middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="n">oneOrMore</span><span class="o">()</span>

<span class="c1">// non-deterministic relaxed contiguity
</span><span class="k">val</span> <span class="n">nonDetermin</span><span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedByAny</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">](</span><span class="s">"followedbyany_start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"followedbyany_middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">).</span><span class="n">optional</span><span class="o">()</span></code></pre></figure>

  </div>
</div>

<p><br /></p>

<div class="codetabs">
  <div data-lang="java">
    <table class="table table-bordered">
    <thead>
        <tr>
            <th class="text-left" style="width: 25%">Pattern Operation</th>
            <th class="text-center">Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>begin(#name)</strong></td>
            <td>
            <p>Defines a starting pattern:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>begin(#pattern_sequence)</strong></td>
            <td>
            <p>Defines a starting pattern:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">start</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>next(#name)</strong></td>
            <td>
                <p>Appends a new pattern. A matching event has to directly succeed the previous matching event
                (strict contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>next(#pattern_sequence)</strong></td>
            <td>
                <p>Appends a new pattern. A sequence of matching events have to directly succeed the previous matching event
                (strict contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">next</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">next</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedBy(#name)</strong></td>
            <td>
                <p>Appends a new pattern. Other events can occur between a matching event and the previous
                matching event (relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">followedBy</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedBy(#pattern_sequence)</strong></td>
            <td>
                 <p>Appends a new pattern. Other events can occur between a sequence of matching events and the previous
                 matching event (relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">followedBy</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedBy</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">);</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedByAny(#name)</strong></td>
            <td>
                <p>Appends a new pattern. Other events can occur between a matching event and the previous
                matching event, and alternative matches will be presented for every alternative matching event
                (non-deterministic relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">followedByAny</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedByAny</span><span class="o">(</span><span class="s">"middle"</span><span class="o">);</span></code></pre></figure>

             </td>
        </tr>
        <tr>
             <td><strong>followedByAny(#pattern_sequence)</strong></td>
             <td>
                 <p>Appends a new pattern. Other events can occur between a sequence of matching events and the previous
                 matching event, and alternative matches will be presented for every alternative sequence of matching events
                 (non-deterministic relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">followedByAny</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">followedByAny</span><span class="o">(</span>
    <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">where</span><span class="o">(...).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(...)</span>
<span class="o">);</span></code></pre></figure>

             </td>
        </tr>
        <tr>
                    <td><strong>notNext()</strong></td>
                    <td>
                        <p>Appends a new negative pattern. A matching (negative) event has to directly succeed the
                        previous matching event (strict contiguity) for the partial match to be discarded:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">notNext</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">notNext</span><span class="o">(</span><span class="s">"not"</span><span class="o">);</span></code></pre></figure>

                    </td>
                </tr>
                <tr>
                    <td><strong>notFollowedBy()</strong></td>
                    <td>
                        <p>Appends a new negative pattern. A partial matching event sequence will be discarded even
                        if other events occur between the matching (negative) event and the previous matching event
                        (relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">notFollowedBy</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="na">notFollowedBy</span><span class="o">(</span><span class="s">"not"</span><span class="o">);</span></code></pre></figure>

                    </td>
                </tr>
       <tr>
          <td><strong>within(time)</strong></td>
          <td>
              <p>Defines the maximum time interval for an event sequence to match the pattern. If a non-completed event
              sequence exceeds this time, it is discarded:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">pattern</span><span class="o">.</span><span class="na">within</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span></code></pre></figure>

          </td>
       </tr>
  </tbody>
</table>
  </div>

  <div data-lang="scala">
    <table class="table table-bordered">
    <thead>
        <tr>
            <th class="text-left" style="width: 25%">Pattern Operation</th>
            <th class="text-center">Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>begin()</strong></td>
            <td>
            <p>Defines a starting pattern:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">start</span> <span class="k">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span><span class="o">](</span><span class="s">"start"</span><span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>next(#name)</strong></td>
            <td>
                <p>Appends a new pattern. A matching event has to directly succeed the previous matching event
                (strict contiguity):</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">next</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>next(#pattern_sequence)</strong></td>
            <td>
                <p>Appends a new pattern. A sequence of matching events have to directly succeed the previous matching event
                (strict contiguity):</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">next</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">next</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span><span class="o">](</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedBy(#name)</strong></td>
            <td>
                <p>Appends a new pattern. Other events can occur between a matching event and the previous
                matching event (relaxed contiguity) :</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">followedBy</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedBy(#pattern_sequence)</strong></td>
            <td>
                <p>Appends a new pattern. Other events can occur between a sequence of matching events and the previous
                matching event (relaxed contiguity) :</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">followedBy</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedBy</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span><span class="o">](</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">)</span></code></pre></figure>

            </td>
        </tr>
        <tr>
            <td><strong>followedByAny(#name)</strong></td>
            <td>
                <p>Appends a new pattern. Other events can occur between a matching event and the previous
                matching event, and alternative matches will be presented for every alternative matching event
                (non-deterministic relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">followedByAny</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedByAny</span><span class="o">(</span><span class="s">"middle"</span><span class="o">)</span></code></pre></figure>

            </td>
         </tr>
         <tr>
             <td><strong>followedByAny(#pattern_sequence)</strong></td>
             <td>
                 <p>Appends a new pattern. Other events can occur between a sequence of matching events and the previous
                 matching event, and alternative matches will be presented for every alternative sequence of matching events
                 (non-deterministic relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">followedByAny</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">followedByAny</span><span class="o">(</span>
    <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">[</span><span class="kt">Event</span><span class="o">](</span><span class="s">"start"</span><span class="o">).</span><span class="n">where</span><span class="o">(...).</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(...)</span>
<span class="o">)</span></code></pre></figure>

             </td>
         </tr>

                <tr>
                                    <td><strong>notNext()</strong></td>
                                    <td>
                                        <p>Appends a new negative pattern. A matching (negative) event has to directly succeed the
                                        previous matching event (strict contiguity) for the partial match to be discarded:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">notNext</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">notNext</span><span class="o">(</span><span class="s">"not"</span><span class="o">)</span></code></pre></figure>

                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>notFollowedBy()</strong></td>
                                    <td>
                                        <p>Appends a new negative pattern. A partial matching event sequence will be discarded even
                                        if other events occur between the matching (negative) event and the previous matching event
                                        (relaxed contiguity):</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">notFollowedBy</span> <span class="k">=</span> <span class="n">start</span><span class="o">.</span><span class="n">notFollowedBy</span><span class="o">(</span><span class="s">"not"</span><span class="o">)</span></code></pre></figure>

                                    </td>
                                </tr>

       <tr>
          <td><strong>within(time)</strong></td>
          <td>
              <p>Defines the maximum time interval for an event sequence to match the pattern. If a non-completed event
              sequence exceeds this time, it is discarded:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">pattern</span><span class="o">.</span><span class="n">within</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span></code></pre></figure>

          </td>
      </tr>
  </tbody>
</table>
  </div>

</div>

<h3 id="after-match-skip-strategy">After Match Skip Strategy</h3>

<p>For a given pattern, the same event may be assigned to multiple successful matches. To control to how many matches an event will be assigned, you need to specify the skip strategy called <code class="highlighter-rouge">AfterMatchSkipStrategy</code>. There are four types of skip strategies, listed as follows:</p>

<ul>
  <li><strong><em>NO_SKIP</em></strong>: Every possible match will be emitted.</li>
  <li><strong><em>SKIP_PAST_LAST_EVENT</em></strong>: Discards every partial match that started after the match started but before it ended.</li>
  <li><strong><em>SKIP_TO_FIRST</em></strong>: Discards every partial match that started after the match started but before the first event of <em>PatternName</em> occurred.</li>
  <li><strong><em>SKIP_TO_LAST</em></strong>: Discards every partial match that started after the match started but before the last event of <em>PatternName</em> occurred.</li>
</ul>

<p>Notice that when using <em>SKIP_TO_FIRST</em> and <em>SKIP_TO_LAST</em> skip strategy, a valid <em>PatternName</em> should also be specified.</p>

<p>For example, for a given pattern <code class="highlighter-rouge">b+ c</code> and a data stream <code class="highlighter-rouge">b1 b2 b3 c</code>, the differences between these four skip strategies are as follows:</p>

<table class="table table-bordered">
    <tr>
        <th class="text-left" style="width: 25%">Skip Strategy</th>
        <th class="text-center" style="width: 25%">Result</th>
        <th class="text-center"> Description</th>
    </tr>
    <tr>
        <td><strong>NO_SKIP</strong></td>
        <td>
            <code>b1 b2 b3 c</code><br />
            <code>b2 b3 c</code><br />
            <code>b3 c</code><br />
        </td>
        <td>After found matching <code>b1 b2 b3 c</code>, the match process will not discard any result.</td>
    </tr>
    <tr>
        <td><strong>SKIP_TO_NEXT</strong></td>
        <td>
            <code>b1 b2 b3 c</code><br />
            <code>b2 b3 c</code><br />
            <code>b3 c</code><br />
        </td>
        <td>After found matching <code>b1 b2 b3 c</code>, the match process will not discard any result, because no other match could start at b1.</td>
    </tr>
    <tr>
        <td><strong>SKIP_PAST_LAST_EVENT</strong></td>
        <td>
            <code>b1 b2 b3 c</code><br />
        </td>
        <td>After found matching <code>b1 b2 b3 c</code>, the match process will discard all started partial matches.</td>
    </tr>
    <tr>
        <td><strong>SKIP_TO_FIRST</strong>[<code>b</code>]</td>
        <td>
            <code>b1 b2 b3 c</code><br />
            <code>b2 b3 c</code><br />
            <code>b3 c</code><br />
        </td>
        <td>After found matching <code>b1 b2 b3 c</code>, the match process will try to discard all partial matches started before <code>b1</code>, but there are no such matches. Therefore nothing will be discarded.</td>
    </tr>
    <tr>
        <td><strong>SKIP_TO_LAST</strong>[<code>b</code>]</td>
        <td>
            <code>b1 b2 b3 c</code><br />
            <code>b3 c</code><br />
        </td>
        <td>After found matching <code>b1 b2 b3 c</code>, the match process will try to discard all partial matches started before <code>b3</code>. There is one such match <code>b2 b3 c</code></td>
    </tr>
</table>

<p>Have a look also at another example to better see the difference between NO_SKIP and SKIP_TO_FIRST:
Pattern: <code class="highlighter-rouge">(a | c) (b | c) c+.greedy d</code> and sequence: <code class="highlighter-rouge">a b c1 c2 c3 d</code> Then the results will be:</p>

<table class="table table-bordered">
    <tr>
        <th class="text-left" style="width: 25%">Skip Strategy</th>
        <th class="text-center" style="width: 25%">Result</th>
        <th class="text-center"> Description</th>
    </tr>
    <tr>
        <td><strong>NO_SKIP</strong></td>
        <td>
            <code>a b c1 c2 c3 d</code><br />
            <code>b c1 c2 c3 d</code><br />
            <code>c1 c2 c3 d</code><br />
            <code>c2 c3 d</code><br />
        </td>
        <td>After found matching <code>a b c1 c2 c3 d</code>, the match process will not discard any result.</td>
    </tr>
    <tr>
        <td><strong>SKIP_TO_FIRST</strong>[<code>b*</code>]</td>
        <td>
            <code>a b c1 c2 c3 d</code><br />
            <code>c1 c2 c3 d</code><br />
        </td>
        <td>After found matching <code>a b c1 c2 c3 d</code>, the match process will discard all partial matches started before <code>c1</code>. There is one such match <code>b c1 c2 c3 d</code>.</td>
    </tr>
</table>

<p>To better understand the difference between NO_SKIP and SKIP_TO_NEXT take a look at following example:
Pattern: <code class="highlighter-rouge">a b+</code> and sequence: <code class="highlighter-rouge">a b1 b2 b3</code> Then the results will be:</p>

<table class="table table-bordered">
    <tr>
        <th class="text-left" style="width: 25%">Skip Strategy</th>
        <th class="text-center" style="width: 25%">Result</th>
        <th class="text-center"> Description</th>
    </tr>
    <tr>
        <td><strong>NO_SKIP</strong></td>
        <td>
            <code>a b1</code><br />
            <code>a b1 b2</code><br />
            <code>a b1 b2 b3</code><br />
        </td>
        <td>After found matching <code>a b1</code>, the match process will not discard any result.</td>
    </tr>
    <tr>
        <td><strong>SKIP_TO_NEXT</strong>[<code>b*</code>]</td>
        <td>
            <code>a b1</code><br />
        </td>
        <td>After found matching <code>a b1</code>, the match process will discard all partial matches started at <code>a</code>. This means neither <code>a b1 b2</code> nor <code>a b1 b2 b3</code> could be generated.</td>
    </tr>
</table>

<p>To specify which skip strategy to use, just create an <code class="highlighter-rouge">AfterMatchSkipStrategy</code> by calling:</p>
<table class="table table-bordered">
    <tr>
        <th class="text-left" width="25%">Function</th>
        <th class="text-center">Description</th>
    </tr>
    <tr>
        <td><code>AfterMatchSkipStrategy.noSkip()</code></td>
        <td>Create a <strong>NO_SKIP</strong> skip strategy </td>
    </tr>
    <tr>
        <td><code>AfterMatchSkipStrategy.skipToNext()</code></td>
        <td>Create a <strong>SKIP_TO_NEXT</strong> skip strategy </td>
    </tr>
    <tr>
        <td><code>AfterMatchSkipStrategy.skipPastLastEvent()</code></td>
        <td>Create a <strong>SKIP_PAST_LAST_EVENT</strong> skip strategy </td>
    </tr>
    <tr>
        <td><code>AfterMatchSkipStrategy.skipToFirst(patternName)</code></td>
        <td>Create a <strong>SKIP_TO_FIRST</strong> skip strategy with the referenced pattern name <i>patternName</i></td>
    </tr>
    <tr>
        <td><code>AfterMatchSkipStrategy.skipToLast(patternName)</code></td>
        <td>Create a <strong>SKIP_TO_LAST</strong> skip strategy with the referenced pattern name <i>patternName</i></td>
    </tr>
</table>

<p>Then apply the skip strategy to a pattern by calling:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">AfterMatchSkipStrategy</span> <span class="n">skipStrategy</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">Pattern</span><span class="o">.</span><span class="na">begin</span><span class="o">(</span><span class="s">"patternName"</span><span class="o">,</span> <span class="n">skipStrategy</span><span class="o">);</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">skipStrategy</span> <span class="k">=</span> <span class="o">...</span>
<span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"patternName"</span><span class="o">,</span> <span class="n">skipStrategy</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p><span class="label label-danger">Attention</span> For SKIP_TO_FIRST/LAST there are two options how to handle cases when there are no elements mapped to
the specified variable. By default a NO_SKIP strategy will be used in this case. The other option is to throw exception in such situation.
One can enable this option by:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">AfterMatchSkipStrategy</span><span class="o">.</span><span class="na">skipToFirst</span><span class="o">(</span><span class="n">patternName</span><span class="o">).</span><span class="na">throwExceptionOnMiss</span><span class="o">()</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="nc">AfterMatchSkipStrategy</span><span class="o">.</span><span class="n">skipToFirst</span><span class="o">(</span><span class="n">patternName</span><span class="o">).</span><span class="n">throwExceptionOnMiss</span><span class="o">()</span></code></pre></figure>

  </div>
</div>

<h2 id="detecting-patterns">Detecting Patterns</h2>

<p>After specifying the pattern sequence you are looking for, it is time to apply it to your input stream to detect
potential matches. To run a stream of events against your pattern sequence, you have to create a <code class="highlighter-rouge">PatternStream</code>.
Given an input stream <code class="highlighter-rouge">input</code>, a pattern <code class="highlighter-rouge">pattern</code> and an optional comparator <code class="highlighter-rouge">comparator</code> used to sort events with the same timestamp in case of EventTime or that arrived at the same moment, you create the <code class="highlighter-rouge">PatternStream</code> by calling:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">pattern</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">EventComparator</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">comparator</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// optional</span>

<span class="n">PatternStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">patternStream</span> <span class="o">=</span> <span class="n">CEP</span><span class="o">.</span><span class="na">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">,</span> <span class="n">comparator</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span> <span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="n">pattern</span> <span class="k">:</span> <span class="kt">Pattern</span><span class="o">[</span><span class="kt">Event</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">var</span> <span class="n">comparator</span> <span class="k">:</span> <span class="kt">EventComparator</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// optional
</span>
<span class="k">val</span> <span class="n">patternStream</span><span class="k">:</span> <span class="kt">PatternStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">,</span> <span class="n">comparator</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>The input stream can be <em>keyed</em> or <em>non-keyed</em> depending on your use-case.</p>

<p><span class="label label-danger">Attention</span> Applying your pattern on a non-keyed stream will result in a job with parallelism equal to 1.</p>

<h3 id="selecting-from-patterns">Selecting from Patterns</h3>

<p>Once you have obtained a <code class="highlighter-rouge">PatternStream</code> you can select from detected event sequences via the <code class="highlighter-rouge">select</code> or <code class="highlighter-rouge">flatSelect</code> methods.</p>

<div class="codetabs">
  <div data-lang="java">
    <p>The <code class="highlighter-rouge">select()</code> method requires a <code class="highlighter-rouge">PatternSelectFunction</code> implementation.
A <code class="highlighter-rouge">PatternSelectFunction</code> has a <code class="highlighter-rouge">select</code> method which is called for each matching event sequence.
It receives a match in the form of <code class="highlighter-rouge">Map&lt;String, List&lt;IN&gt;&gt;</code> where the key is the name of each pattern in your pattern
sequence and the value is a list of all accepted events for that pattern (<code class="highlighter-rouge">IN</code> is the type of your input elements).
The events for a given pattern are ordered by timestamp. The reason for returning a list of accepted events for each
pattern is that when using looping patterns (e.g. <code class="highlighter-rouge">oneToMany()</code> and <code class="highlighter-rouge">times()</code>), more than one event may be accepted for a given pattern. The selection function returns exactly one result.</p>

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyPatternSelectFunction</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">,</span> <span class="n">OUT</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">PatternSelectFunction</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">,</span> <span class="n">OUT</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">OUT</span> <span class="nf">select</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">&gt;&gt;</span> <span class="n">pattern</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">IN</span> <span class="n">startEvent</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">IN</span> <span class="n">endEvent</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">OUT</span><span class="o">(</span><span class="n">startEvent</span><span class="o">,</span> <span class="n">endEvent</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

    <p>A <code class="highlighter-rouge">PatternFlatSelectFunction</code> is similar to the <code class="highlighter-rouge">PatternSelectFunction</code>, with the only distinction that it can return an
arbitrary number of results. To do this, the <code class="highlighter-rouge">select</code> method has an additional <code class="highlighter-rouge">Collector</code> parameter which is
used to forward your output elements downstream.</p>

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyPatternFlatSelectFunction</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">,</span> <span class="n">OUT</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">PatternFlatSelectFunction</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">,</span> <span class="n">OUT</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">flatSelect</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">IN</span><span class="o">&gt;&gt;</span> <span class="n">pattern</span><span class="o">,</span> <span class="n">Collector</span><span class="o">&lt;</span><span class="n">OUT</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">IN</span> <span class="n">startEvent</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">IN</span> <span class="n">endEvent</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">startEvent</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span> <span class="n">i</span><span class="o">++</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">collector</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="k">new</span> <span class="n">OUT</span><span class="o">(</span><span class="n">startEvent</span><span class="o">,</span> <span class="n">endEvent</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">
    <p>The <code class="highlighter-rouge">select()</code> method takes a selection function as argument, which is called for each matching event sequence.
It receives a match in the form of <code class="highlighter-rouge">Map[String, Iterable[IN]]</code> where the key is the name of each pattern in your pattern
sequence and the value is an Iterable over all accepted events for that pattern (<code class="highlighter-rouge">IN</code> is the type of your input elements).</p>

    <p>The events for a given pattern are ordered by timestamp. The reason for returning an iterable of accepted events for each pattern is that when using looping patterns (e.g. <code class="highlighter-rouge">oneToMany()</code> and <code class="highlighter-rouge">times()</code>), more than one event may be accepted for a given pattern. The selection function returns exactly one result per call.</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">selectFn</span><span class="o">(</span><span class="n">pattern</span> <span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">IN</span><span class="o">]])</span><span class="k">:</span> <span class="kt">OUT</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">startEvent</span> <span class="k">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">next</span>
    <span class="k">val</span> <span class="n">endEvent</span> <span class="k">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">next</span>
    <span class="nc">OUT</span><span class="o">(</span><span class="n">startEvent</span><span class="o">,</span> <span class="n">endEvent</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

    <p>The <code class="highlighter-rouge">flatSelect</code> method is similar to the <code class="highlighter-rouge">select</code> method. Their only difference is that the function passed to the
<code class="highlighter-rouge">flatSelect</code> method can return an arbitrary number of results per call. In order to do this, the function for
<code class="highlighter-rouge">flatSelect</code> has an additional <code class="highlighter-rouge">Collector</code> parameter which is used to forward your output elements downstream.</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">flatSelectFn</span><span class="o">(</span><span class="n">pattern</span> <span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">IN</span><span class="o">]],</span> <span class="n">collector</span> <span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">OUT</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">startEvent</span> <span class="k">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"start"</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">next</span>
    <span class="k">val</span> <span class="n">endEvent</span> <span class="k">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">next</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">startEvent</span><span class="o">.</span><span class="n">getValue</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">collector</span><span class="o">.</span><span class="n">collect</span><span class="o">(</span><span class="nc">OUT</span><span class="o">(</span><span class="n">startEvent</span><span class="o">,</span> <span class="n">endEvent</span><span class="o">))</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<h3 id="handling-timed-out-partial-patterns">Handling Timed Out Partial Patterns</h3>

<p>Whenever a pattern has a window length attached via the <code class="highlighter-rouge">within</code> keyword, it is possible that partial event sequences
are discarded because they exceed the window length. To react to these timed out partial matches the <code class="highlighter-rouge">select</code>
and <code class="highlighter-rouge">flatSelect</code> API calls allow you to specify a timeout handler. This timeout handler is called for each timed out
partial event sequence. The timeout handler receives all the events that have been matched so far by the pattern, and
the timestamp when the timeout was detected.</p>

<p>To treat partial patterns, the <code class="highlighter-rouge">select</code> and <code class="highlighter-rouge">flatSelect</code> API calls offer an overloaded version which takes as
parameters</p>

<ul>
  <li><code class="highlighter-rouge">PatternTimeoutFunction</code>/<code class="highlighter-rouge">PatternFlatTimeoutFunction</code></li>
  <li><a href="//flink-china.org/doc/blink/dev/stream/side_output.html">OutputTag</a> for the side output in which the timed out matches will be returned</li>
  <li>and the known <code class="highlighter-rouge">PatternSelectFunction</code>/<code class="highlighter-rouge">PatternFlatSelectFunction</code>.</li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">PatternStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">patternStream</span> <span class="o">=</span> <span class="n">CEP</span><span class="o">.</span><span class="na">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">);</span>

<span class="n">OutputTag</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">outputTag</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OutputTag</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="s">"side-output"</span><span class="o">){};</span>

<span class="n">SingleOutputStreamOperator</span><span class="o">&lt;</span><span class="n">ComplexEvent</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="na">select</span><span class="o">(</span>
    <span class="n">outputTag</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">PatternTimeoutFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">TimeoutEvent</span><span class="o">&gt;()</span> <span class="o">{...},</span>
    <span class="k">new</span> <span class="n">PatternSelectFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">ComplexEvent</span><span class="o">&gt;()</span> <span class="o">{...}</span>
<span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">TimeoutEvent</span><span class="o">&gt;</span> <span class="n">timeoutResult</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getSideOutput</span><span class="o">(</span><span class="n">outputTag</span><span class="o">);</span>

<span class="n">SingleOutputStreamOperator</span><span class="o">&lt;</span><span class="n">ComplexEvent</span><span class="o">&gt;</span> <span class="n">flatResult</span> <span class="o">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="na">flatSelect</span><span class="o">(</span>
    <span class="n">outputTag</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">PatternFlatTimeoutFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">TimeoutEvent</span><span class="o">&gt;()</span> <span class="o">{...},</span>
    <span class="k">new</span> <span class="n">PatternFlatSelectFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">ComplexEvent</span><span class="o">&gt;()</span> <span class="o">{...}</span>
<span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">TimeoutEvent</span><span class="o">&gt;</span> <span class="n">timeoutFlatResult</span> <span class="o">=</span> <span class="n">flatResult</span><span class="o">.</span><span class="na">getSideOutput</span><span class="o">(</span><span class="n">outputTag</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">patternStream</span><span class="k">:</span> <span class="kt">PatternStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">)</span>

<span class="k">val</span> <span class="n">outputTag</span> <span class="k">=</span> <span class="nc">OutputTag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"side-output"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">SingleOutputStreamOperator</span><span class="o">[</span><span class="kt">ComplexEvent</span><span class="o">]</span> <span class="k">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">outputTag</span><span class="o">){</span>
    <span class="o">(</span><span class="n">pattern</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Event</span><span class="o">]],</span> <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">TimeoutEvent</span><span class="o">()</span>
<span class="o">}</span> <span class="o">{</span>
    <span class="n">pattern</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Event</span><span class="o">]]</span> <span class="k">=&gt;</span> <span class="nc">ComplexEvent</span><span class="o">()</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">timeoutResult</span><span class="k">:</span> <span class="kt">DataStream&lt;TimeoutEvent&gt;</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getSideOutput</span><span class="o">(</span><span class="n">outputTag</span><span class="o">)</span></code></pre></figure>

    <p>The <code class="highlighter-rouge">flatSelect</code> API call offers the same overloaded version which takes as the first parameter a timeout function and as second parameter a selection function.
In contrast to the <code class="highlighter-rouge">select</code> functions, the <code class="highlighter-rouge">flatSelect</code> functions are called with a <code class="highlighter-rouge">Collector</code>. You can use the collector to emit an arbitrary number of events.</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">patternStream</span><span class="k">:</span> <span class="kt">PatternStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">)</span>

<span class="k">val</span> <span class="n">outputTag</span> <span class="k">=</span> <span class="nc">OutputTag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"side-output"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">SingleOutputStreamOperator</span><span class="o">[</span><span class="kt">ComplexEvent</span><span class="o">]</span> <span class="k">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="n">flatSelect</span><span class="o">(</span><span class="n">outputTag</span><span class="o">){</span>
    <span class="o">(</span><span class="n">pattern</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Event</span><span class="o">]],</span> <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">out</span><span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">TimeoutEvent</span><span class="o">])</span> <span class="k">=&gt;</span>
        <span class="n">out</span><span class="o">.</span><span class="n">collect</span><span class="o">(</span><span class="nc">TimeoutEvent</span><span class="o">())</span>
<span class="o">}</span> <span class="o">{</span>
    <span class="o">(</span><span class="n">pattern</span><span class="k">:</span> <span class="kt">mutable.Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">Event</span><span class="o">]],</span> <span class="n">out</span><span class="k">:</span> <span class="kt">Collector</span><span class="o">[</span><span class="kt">ComplexEvent</span><span class="o">])</span> <span class="k">=&gt;</span>
        <span class="n">out</span><span class="o">.</span><span class="n">collect</span><span class="o">(</span><span class="nc">ComplexEvent</span><span class="o">())</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">timeoutResult</span><span class="k">:</span> <span class="kt">DataStream&lt;TimeoutEvent&gt;</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getSideOutput</span><span class="o">(</span><span class="n">outputTag</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h2 id="handling-lateness-in-event-time">Handling Lateness in Event Time</h2>

<p>In <code class="highlighter-rouge">CEP</code> the order in which elements are processed matters. To guarantee that elements are processed in the correct order when working in event time, an incoming element is initially put in a buffer where elements are <em>sorted in ascending order based on their timestamp</em>, and when a watermark arrives, all the elements in this buffer with timestamps smaller than that of the watermark are processed. This implies that elements between watermarks are processed in event-time order.</p>

<p><span class="label label-danger">Attention</span> The library assumes correctness of the watermark when working in event time.</p>

<p>To guarantee that elements across watermarks are processed in event-time order, Flink’s CEP library assumes
<em>correctness of the watermark</em>, and considers as <em>late</em> elements whose timestamp is smaller than that of the last
seen watermark. Late elements are not further processed. Also, you can specify a sideOutput tag to collect the late elements come after the last seen watermark, you can use it like this.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">PatternStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">patternStream</span> <span class="o">=</span> <span class="n">CEP</span><span class="o">.</span><span class="na">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">);</span>

<span class="n">OutputTag</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lateDataOutputTag</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OutputTag</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="s">"late-data"</span><span class="err">"</span><span class="o">){};</span>

<span class="n">SingleOutputStreamOperator</span><span class="o">&lt;</span><span class="n">ComplexEvent</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">patternStream</span>
    <span class="o">.</span><span class="na">sideOutputLateData</span><span class="o">(</span><span class="n">lateDataOutputTag</span><span class="o">)</span>
    <span class="o">.</span><span class="na">select</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">PatternSelectFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">ComplexEvent</span><span class="o">&gt;()</span> <span class="o">{...}</span>
    <span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lateData</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getSideOutput</span><span class="o">(</span><span class="n">lateDataOutputTag</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">patternStream</span><span class="k">:</span> <span class="kt">PatternStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">pattern</span><span class="o">)</span>

<span class="k">val</span> <span class="n">lateDataOutputTag</span> <span class="k">=</span> <span class="nc">OutputTag</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"late-data"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">SingleOutputStreamOperator</span><span class="o">[</span><span class="kt">ComplexEvent</span><span class="o">]</span> <span class="k">=</span> <span class="n">patternStream</span>
      <span class="o">.</span><span class="n">sideOutputLateData</span><span class="o">(</span><span class="n">lateDataOutputTag</span><span class="o">)</span>
      <span class="o">.</span><span class="n">select</span><span class="o">{</span>
          <span class="n">pattern</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Iterable</span><span class="o">[</span><span class="kt">ComplexEvent</span><span class="o">]]</span> <span class="k">=&gt;</span> <span class="nc">ComplexEvent</span><span class="o">()</span>
      <span class="o">}</span>

<span class="k">val</span> <span class="n">lateData</span><span class="k">:</span> <span class="kt">DataStream&lt;String&gt;</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getSideOutput</span><span class="o">(</span><span class="n">lateDataOutputTag</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h2 id="examples">Examples</h2>

<p>The following example detects the pattern <code class="highlighter-rouge">start, middle(name = "error") -&gt; end(name = "critical")</code> on a keyed data
stream of <code class="highlighter-rouge">Events</code>. The events are keyed by their <code class="highlighter-rouge">id</code>s and a valid pattern has to occur within 10 seconds.
The whole processing is done with event time.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">env</span><span class="o">.</span><span class="na">setStreamTimeCharacteristic</span><span class="o">(</span><span class="n">TimeCharacteristic</span><span class="o">.</span><span class="na">EventTime</span><span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">partitionedInput</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">keyBy</span><span class="o">(</span><span class="k">new</span> <span class="n">KeySelector</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getKey</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">});</span>

<span class="n">Pattern</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.&lt;</span><span class="n">Event</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"error"</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}).</span><span class="na">followedBy</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleCondition</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">filter</span><span class="o">(</span><span class="n">Event</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"critical"</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}).</span><span class="na">within</span><span class="o">(</span><span class="n">Time</span><span class="o">.</span><span class="na">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>

<span class="n">PatternStream</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="n">patternStream</span> <span class="o">=</span> <span class="n">CEP</span><span class="o">.</span><span class="na">pattern</span><span class="o">(</span><span class="n">partitionedInput</span><span class="o">,</span> <span class="n">pattern</span><span class="o">);</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">Alert</span><span class="o">&gt;</span> <span class="n">alerts</span> <span class="o">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="k">new</span> <span class="n">PatternSelectFunction</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">,</span> <span class="n">Alert</span><span class="o">&gt;()</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Alert</span> <span class="nf">select</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;&gt;</span> <span class="n">pattern</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nf">createAlert</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">});</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">env</span> <span class="k">:</span> <span class="kt">StreamExecutionEnvironment</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">env</span><span class="o">.</span><span class="n">setStreamTimeCharacteristic</span><span class="o">(</span><span class="nc">TimeCharacteristic</span><span class="o">.</span><span class="nc">EventTime</span><span class="o">)</span>

<span class="k">val</span> <span class="n">input</span> <span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">partitionedInput</span> <span class="k">=</span> <span class="n">input</span><span class="o">.</span><span class="n">keyBy</span><span class="o">(</span><span class="n">event</span> <span class="k">=&gt;</span> <span class="n">event</span><span class="o">.</span><span class="n">getId</span><span class="o">)</span>

<span class="k">val</span> <span class="n">pattern</span> <span class="k">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="n">begin</span><span class="o">(</span><span class="s">"start"</span><span class="o">)</span>
  <span class="o">.</span><span class="n">next</span><span class="o">(</span><span class="s">"middle"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span> <span class="o">==</span> <span class="s">"error"</span><span class="o">)</span>
  <span class="o">.</span><span class="n">followedBy</span><span class="o">(</span><span class="s">"end"</span><span class="o">).</span><span class="n">where</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">getName</span> <span class="o">==</span> <span class="s">"critical"</span><span class="o">)</span>
  <span class="o">.</span><span class="n">within</span><span class="o">(</span><span class="nc">Time</span><span class="o">.</span><span class="n">seconds</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>

<span class="k">val</span> <span class="n">patternStream</span> <span class="k">=</span> <span class="nc">CEP</span><span class="o">.</span><span class="n">pattern</span><span class="o">(</span><span class="n">partitionedInput</span><span class="o">,</span> <span class="n">pattern</span><span class="o">)</span>

<span class="k">val</span> <span class="n">alerts</span> <span class="k">=</span> <span class="n">patternStream</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">createAlert</span><span class="o">(</span><span class="k">_</span><span class="o">)))</span></code></pre></figure>

  </div>
</div>

<h2 id="migrating-from-an-older-flink-versionpre-13">Migrating from an older Flink version(pre 1.3)</h2>

<h3 id="migrating-to-14">Migrating to 1.4+</h3>

<p>In Flink-1.4 the backward compatibility of CEP library with &lt;= Flink 1.2 was dropped. Unfortunately 
it is not possible to restore a CEP job that was once run with 1.2.x</p>

<h3 id="migrating-to-13x">Migrating to 1.3.x</h3>

<p>The CEP library in Flink-1.3 ships with a number of new features which have led to some changes in the API. Here we
describe the changes that you need to make to your old CEP jobs, in order to be able to run them with Flink-1.3. After
making these changes and recompiling your job, you will be able to resume its execution from a savepoint taken with the
old version of your job, <em>i.e.</em> without having to re-process your past data.</p>

<p>The changes required are:</p>

<ol>
  <li>
    <p>Change your conditions (the ones in the <code class="highlighter-rouge">where(...)</code> clause) to extend the <code class="highlighter-rouge">SimpleCondition</code> class instead of
implementing the <code class="highlighter-rouge">FilterFunction</code> interface.</p>
  </li>
  <li>
    <p>Change your functions provided as arguments to the <code class="highlighter-rouge">select(...)</code> and <code class="highlighter-rouge">flatSelect(...)</code> methods to expect a list of
events associated with each pattern (<code class="highlighter-rouge">List</code> in <code class="highlighter-rouge">Java</code>, <code class="highlighter-rouge">Iterable</code> in <code class="highlighter-rouge">Scala</code>). This is because with the addition of
the looping patterns, multiple input events can match a single (looping) pattern.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">followedBy()</code> in Flink 1.1 and 1.2 implied <code class="highlighter-rouge">non-deterministic relaxed contiguity</code> (see
<a href="#conditions-on-contiguity">here</a>). In Flink 1.3 this has changed and <code class="highlighter-rouge">followedBy()</code> implies <code class="highlighter-rouge">relaxed contiguity</code>,
while <code class="highlighter-rouge">followedByAny()</code> should be used if <code class="highlighter-rouge">non-deterministic relaxed contiguity</code> is required.</p>
  </li>
</ol>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//flink-china.org/doc/blink/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//flink-china.org/doc/blink/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
