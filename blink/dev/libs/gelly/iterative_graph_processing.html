<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.5.1 Documentation: Iterative Graph Processing</title>
    <link rel="shortcut icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//flink-china.org/doc/blink/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/flink.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/syntax.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/css/codetabs.css">
    <link rel="stylesheet" href="//flink-china.org/doc/blink/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      













<div class="sidenav-logo">
  <p><a href="//flink-china.org/doc/blink"><img class="bottom" alt="Apache Flink" src="//flink-china.org/doc/blink/page/img/navbar-brand-logo.jpg"></a> v1.5.1</p>
</div>
<ul id="sidenav">

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-6" data-toggle="collapse"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-6"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse">API Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/datastream_api.html">DataStream API</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-10" data-toggle="collapse">Setup Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-10"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/local_setup.html">Local Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/tutorials/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/setup_quickstart.html"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-16" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-16"><ul>
  <li><a href="//flink-china.org/doc/blink/examples/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/examples.html">DataStream Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/examples.html">DataSet Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/stream_sql_quickstart.html">Stream SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/batch_sql_quickstart.html">Batch SQL Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_shell_quickstart.html">Scala Shell Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/zeppelin_quickstart.html">Flink on Zeppelin Examples</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/examples.html">Flink-Hive Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-25" data-toggle="collapse"><i class="fa fa-cogs title maindish" aria-hidden="true"></i> Project Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-25"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/java_api_quickstart.html">Project Template for Java</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/quickstart/scala_api_quickstart.html">Project Template for Scala</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/dependencies.html">Configuring Dependencies, Connectors, Libraries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/ide_setup.html">IDE Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_shell.html">Scala Shell</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/start/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-34" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-34"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-35" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-35"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/java8.html">Java 8</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-39" data-toggle="collapse">Streaming (DataStream API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-39"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-40" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-40"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-44" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-44"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/state/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/broadcast_state.html">The Broadcast State Pattern</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/state/custom_serialization.html">Custom Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-52" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-52"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/stream/operators/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-57" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-57"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/connectors/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/stream/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/dev/stream/experimental.html">Experimental Features</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-73" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-73"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/batch/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-84" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-84"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/hive_compatibility.html">Hive Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-87" data-toggle="collapse">Streaming Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-87"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/table/streaming/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/dynamic_tables.html">Dynamic Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/time_attributes.html">Time Attributes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/joins.html">Joins in Continuous Queries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/temporal_tables.html">Temporal Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/match_recognize.html">Detecting Patterns</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sql.html">SQL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/supported_ddl.html">SQL Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sourceSinks.html">Table Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/sqlClient.html">SQL Client</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/resource.html">SQL Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/catalog.html">Catalog</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/streaming_optimization.html">Streaming Aggregation Optimization</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/table/multiple_tablesink_optimization.html">Multiple TableSink Optimization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-106" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-106"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-109" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-109"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-116" data-toggle="collapse" class="active">Libraries</a><div class="collapse in" id="collapse-116"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-118" data-toggle="collapse" class="active">Graphs: Gelly</a><div class="collapse in" id="collapse-118"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/gelly/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/iterative_graph_processing.html" class="active">Iterative Graph Processing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-126" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-126"><ul>
  <li><a href="//flink-china.org/doc/blink/dev/libs/ml/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-145" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-145"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-146" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-146"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/deployment/hadoop.html">Hadoop Integration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-157" data-toggle="collapse">High Availability (HA) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-157"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_high_availability.html">JobManager High Availability (HA)</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/ha/jobmanager_failover.html">JobManager Failover</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-161" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-161"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//flink-china.org/doc/blink/ops/config.html">Configuration</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/cli.html">CLI</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/zeppelin.html">Flink on Zeppelin</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/filesystems.html">File Systems</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-176" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-176"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/logging.html">Logging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/monitoring/debugging_job_resources.html">Debugging Job Resources</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-188" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-188"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/components.html">Component Stack</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/taskmanager_resource.html">TaskManager Resource</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//flink-china.org/doc/blink/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//flink-china.org/doc/blink/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li>Libraries</li>
  

  
  
    <li><a href="//flink-china.org/doc/blink/dev/libs/gelly/">Graphs: Gelly</a></li>
  

  
  
    <li class="active">Iterative Graph Processing</li>
  

</ol>

<h1>Iterative Graph Processing</h1>




<p>Gelly exploits Flink’s efficient iteration operators to support large-scale iterative graph processing. Currently, we provide implementations of the vertex-centric, scatter-gather, and gather-sum-apply models. In the following sections, we describe these abstractions and show how you can use them in Gelly.</p>

<ul id="markdown-toc">
  <li><a href="#vertex-centric-iterations" id="markdown-toc-vertex-centric-iterations">Vertex-Centric Iterations</a></li>
  <li><a href="#configuring-a-vertex-centric-iteration" id="markdown-toc-configuring-a-vertex-centric-iteration">Configuring a Vertex-Centric Iteration</a></li>
  <li><a href="#scatter-gather-iterations" id="markdown-toc-scatter-gather-iterations">Scatter-Gather Iterations</a></li>
  <li><a href="#configuring-a-scatter-gather-iteration" id="markdown-toc-configuring-a-scatter-gather-iteration">Configuring a Scatter-Gather Iteration</a></li>
  <li><a href="#gather-sum-apply-iterations" id="markdown-toc-gather-sum-apply-iterations">Gather-Sum-Apply Iterations</a></li>
  <li><a href="#configuring-a-gather-sum-apply-iteration" id="markdown-toc-configuring-a-gather-sum-apply-iteration">Configuring a Gather-Sum-Apply Iteration</a></li>
  <li><a href="#iteration-abstractions-comparison" id="markdown-toc-iteration-abstractions-comparison">Iteration Abstractions Comparison</a></li>
</ul>

<h2 id="vertex-centric-iterations">Vertex-Centric Iterations</h2>
<p>The vertex-centric model, also known as “think like a vertex” or “Pregel”, expresses computation from the perspective of a vertex in the graph.
The computation proceeds in synchronized iteration steps, called supersteps. In each superstep, each vertex executes one user-defined function.
Vertices communicate with other vertices through messages. A vertex can send a message to any other vertex in the graph, as long as it knows its unique ID.</p>

<p>The computational model is shown in the figure below. The dotted boxes correspond to parallelization units.
In each superstep, all active vertices execute the
same user-defined computation in parallel. Supersteps are executed synchronously, so that messages sent during one superstep are guaranteed to be delivered in the beginning of the next superstep.</p>

<p class="text-center">
    <img alt="Vertex-Centric Computational Model" width="70%" src="//flink-china.org/doc/blink/fig/vertex-centric supersteps.png" />
</p>

<p>To use vertex-centric iterations in Gelly, the user only needs to define the vertex compute function, <code class="highlighter-rouge">ComputeFunction</code>.
This function and the maximum number of iterations to run are given as parameters to Gelly’s <code class="highlighter-rouge">runVertexCentricIteration</code>. This method will execute the vertex-centric iteration on the input Graph and return a new Graph, with updated vertex values. An optional message combiner, <code class="highlighter-rouge">MessageCombiner</code>, can be defined to reduce communication costs.</p>

<p>Let us consider computing Single-Source-Shortest-Paths with vertex-centric iterations. Initially, each vertex has a value of infinite distance, except from the source vertex, which has a value of zero. During the first superstep, the source propagates distances to its neighbors. During the following supersteps, each vertex checks its received messages and chooses the minimum distance among them. If this distance is smaller than its current value, it updates its state and produces messages for its neighbors. If a vertex does not change its value during a superstep, then it does not produce any messages for its neighbors for the next superstep. The algorithm converges when there are no value updates or the maximum number of supersteps has been reached. In this algorithm, a message combiner can be used to reduce the number of messages sent to a target vertex.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the vertex-centric iteration</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runVertexCentricIteration</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">SSSPComputeFunction</span><span class="o">(),</span> <span class="k">new</span> <span class="n">SSSPCombiner</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="n">DataSet</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">SSSPComputeFunction</span> <span class="kd">extends</span> <span class="n">ComputeFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">compute</span><span class="o">(</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">MessageIterator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>

    <span class="kt">double</span> <span class="n">minDistance</span> <span class="o">=</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">srcId</span><span class="o">))</span> <span class="o">?</span> <span class="mi">0</span><span class="n">d</span> <span class="o">:</span> <span class="n">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">;</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="n">msg</span> <span class="o">:</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">minDistance</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">minDistance</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">minDistance</span> <span class="o">&lt;</span> <span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Edge</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="nl">e:</span> <span class="n">getEdges</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">sendMessageTo</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">minDistance</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// message combiner</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">SSSPCombiner</span> <span class="kd">extends</span> <span class="n">MessageCombiner</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">combineMessages</span><span class="o">(</span><span class="n">MessageIterator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>

        <span class="kt">double</span> <span class="n">minMessage</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Double</span> <span class="nl">msg:</span> <span class="n">messages</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">minMessage</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">minMessage</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">sendCombinedMessage</span><span class="o">(</span><span class="n">minMessage</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph
</span><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations
</span><span class="k">val</span> <span class="n">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the vertex-centric iteration
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runVertexCentricIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">SSSPComputeFunction</span><span class="o">,</span> <span class="k">new</span> <span class="nc">SSSPCombiner</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result
</span><span class="k">val</span> <span class="n">singleSourceShortestPaths</span> <span class="k">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getVertices</span>


<span class="c1">// - - -  UDFs - - - //
</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">SSSPComputeFunction</span> <span class="k">extends</span> <span class="nc">ComputeFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">compute</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">],</span> <span class="n">messages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">getId</span><span class="o">.</span><span class="n">equals</span><span class="o">(</span><span class="n">srcId</span><span class="o">))</span> <span class="mi">0</span> <span class="k">else</span> <span class="nc">Double</span><span class="o">.</span><span class="nc">MaxValue</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">val</span> <span class="n">msg</span> <span class="k">=</span> <span class="n">messages</span><span class="o">.</span><span class="n">next</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">getValue</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">)</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">edge</span><span class="k">:</span> <span class="kt">Edge</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">&lt;-</span> <span class="n">getEdges</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">sendMessageTo</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="n">getTarget</span><span class="o">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">getValue</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">getValue</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// message combiner
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">SSSPCombiner</span> <span class="k">extends</span> <span class="nc">MessageCombiner</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">combineMessages</span><span class="o">(</span><span class="n">messages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="o">{</span>

        <span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="nc">Double</span><span class="o">.</span><span class="nc">MaxValue</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">val</span> <span class="n">msg</span> <span class="k">=</span> <span class="n">inMessages</span><span class="o">.</span><span class="n">next</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
          <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">sendCombinedMessage</span><span class="o">(</span><span class="n">minMessage</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-vertex-centric-iteration">Configuring a Vertex-Centric Iteration</h2>
<p>A vertex-centric iteration can be configured using a <code class="highlighter-rouge">VertexCentricConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the vertex-centric iteration. The name is displayed in logs and messages
and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines
all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">ComputeFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//flink-china.org/doc/blink/dev/batch/index.html#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">ComputeFunction</code>, using the <code class="highlighter-rouge">addBroadcastSet()</code> method.</p>
  </li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">VertexCentricConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VertexCentricConfiguration</span><span class="o">();</span>

<span class="c1">// set the iteration name</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">);</span>

<span class="c1">// set the parallelism</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">);</span>

<span class="c1">// register an aggregator</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="n">LongSumAggregator</span><span class="o">());</span>

<span class="c1">// run the vertex-centric iteration, also passing the configuration parameters</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
            <span class="n">graph</span><span class="o">.</span><span class="na">runVertexCentricIteration</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">Compute</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined function</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Compute</span> <span class="kd">extends</span> <span class="n">ComputeFunction</span> <span class="o">{</span>

    <span class="n">LongSumAggregator</span> <span class="n">aggregator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LongSumAggregator</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preSuperstep</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// retrieve the Aggregator</span>
        <span class="n">aggregator</span> <span class="o">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">compute</span><span class="o">(</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">MessageIterator</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//do some computation</span>
        <span class="n">Long</span> <span class="n">partialValue</span> <span class="o">=</span> <span class="o">...</span>

        <span class="c1">// aggregate the partial value</span>
        <span class="n">aggregator</span><span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">);</span>

        <span class="c1">// update the vertex value</span>
        <span class="n">setNewVertexValue</span><span class="o">(...);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VertexCentricConfiguration</span>

<span class="c1">// set the iteration name
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">)</span>

<span class="c1">// set the parallelism
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span>

<span class="c1">// register an aggregator
</span><span class="n">parameters</span><span class="o">.</span><span class="n">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">)</span>

<span class="c1">// run the vertex-centric iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runVertexCentricIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Compute</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Combiner</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined function
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">Compute</span> <span class="k">extends</span> <span class="nc">ComputeFunction</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">aggregator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">preSuperstep</span> <span class="o">{</span>

        <span class="c1">// retrieve the Aggregator
</span>        <span class="n">aggregator</span> <span class="k">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">)</span>
    <span class="o">}</span>


    <span class="k">override</span> <span class="k">def</span> <span class="n">compute</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span> <span class="o">{</span>

        <span class="c1">//do some computation
</span>        <span class="k">val</span> <span class="n">partialValue</span> <span class="k">=</span> <span class="o">...</span>

        <span class="c1">// aggregate the partial value
</span>        <span class="n">aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">)</span>

        <span class="c1">// update the vertex value
</span>        <span class="n">setNewVertexValue</span><span class="o">(...)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="scatter-gather-iterations">Scatter-Gather Iterations</h2>
<p>The scatter-gather model, also known as “signal/collect” model, expresses computation from the perspective of a vertex in the graph. The computation proceeds in synchronized iteration steps, called supersteps. In each superstep, a vertex produces messages for other vertices and updates its value based on the messages it receives. To use scatter-gather iterations in Gelly, the user only needs to define how a vertex behaves in each superstep:</p>

<ul>
  <li><strong>Scatter</strong>:  produces the messages that a vertex will send to other vertices.</li>
  <li><strong>Gather</strong>: updates the vertex value using received messages.</li>
</ul>

<p>Gelly provides methods for scatter-gather iterations. The user only needs to implement two functions, corresponding to the scatter and gather phases. The first function is a <code class="highlighter-rouge">ScatterFunction</code>, which allows a vertex to send out messages to other vertices. Messages are received during the same superstep as they are sent. The second function is <code class="highlighter-rouge">GatherFunction</code>, which defines how a vertex will update its value based on the received messages.
These functions and the maximum number of iterations to run are given as parameters to Gelly’s <code class="highlighter-rouge">runScatterGatherIteration</code>. This method will execute the scatter-gather iteration on the input Graph and return a new Graph, with updated vertex values.</p>

<p>A scatter-gather iteration can be extended with information such as the total number of vertices, the in degree and out degree.
Additionally, the  neighborhood type (in/out/all) over which to run the scatter-gather iteration can be specified. By default, the updates from the in-neighbors are used to modify the current vertex’s state and messages are sent to out-neighbors.</p>

<p>Let us consider computing Single-Source-Shortest-Paths with scatter-gather iterations on the following graph and let vertex 1 be the source. In each superstep, each vertex sends a candidate distance message to all its neighbors. The message value is the sum of the current value of the vertex and the edge weight connecting this vertex with its neighbor. Upon receiving candidate distance messages, each vertex calculates the minimum distance and, if a shorter path has been discovered, it updates its value. If a vertex does not change its value during a superstep, then it does not produce messages for its neighbors for the next superstep. The algorithm converges when there are no value updates.</p>

<p class="text-center">
    <img alt="Scatter-gather SSSP superstep 1" width="70%" src="//flink-china.org/doc/blink/fig/gelly-vc-sssp1.png" />
</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the scatter-gather iteration</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">MinDistanceMessenger</span><span class="o">(),</span> <span class="k">new</span> <span class="n">VertexDistanceUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="n">DataSet</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// scatter: messaging</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MinDistanceMessenger</span> <span class="kd">extends</span> <span class="n">ScatterFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessages</span><span class="o">(</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="n">Edge</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">edge</span> <span class="o">:</span> <span class="n">getEdges</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">sendMessageTo</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// gather: vertex update</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexDistanceUpdater</span> <span class="kd">extends</span> <span class="n">GatherFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">MessageIterator</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Double</span> <span class="n">minDistance</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>

		<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">msg</span> <span class="o">:</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">minDistance</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph
</span><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations
</span><span class="k">val</span> <span class="n">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the scatter-gather iteration
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">MinDistanceMessenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexDistanceUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result
</span><span class="k">val</span> <span class="n">singleSourceShortestPaths</span> <span class="k">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getVertices</span>


<span class="c1">// - - -  UDFs - - - //
</span>
<span class="c1">// messaging
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">MinDistanceMessenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">sendMessages</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">for</span> <span class="o">(</span><span class="n">edge</span><span class="k">:</span> <span class="kt">Edge</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">&lt;-</span> <span class="n">getEdges</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">sendMessageTo</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="n">getTarget</span><span class="o">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">getValue</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">getValue</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// vertex update
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">VertexDistanceUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">updateVertex</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">var</span> <span class="n">minDistance</span> <span class="k">=</span> <span class="nc">Double</span><span class="o">.</span><span class="nc">MaxValue</span>

		<span class="k">while</span> <span class="o">(</span><span class="n">inMessages</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
		  <span class="k">val</span> <span class="n">msg</span> <span class="k">=</span> <span class="n">inMessages</span><span class="o">.</span><span class="n">next</span>
		  <span class="k">if</span> <span class="o">(</span><span class="n">msg</span> <span class="o">&lt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">minDistance</span> <span class="k">=</span> <span class="n">msg</span>
		  <span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">getValue</span> <span class="o">&gt;</span> <span class="n">minDistance</span><span class="o">)</span> <span class="o">{</span>
		  <span class="n">setNewVertexValue</span><span class="o">(</span><span class="n">minDistance</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-scatter-gather-iteration">Configuring a Scatter-Gather Iteration</h2>
<p>A scatter-gather iteration can be configured using a <code class="highlighter-rouge">ScatterGatherConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the scatter-gather iteration. The name is displayed in logs and messages
and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines
all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">ScatterFunction</code> and <code class="highlighter-rouge">GatherFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//flink-china.org/doc/blink/dev/batch/index.html#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">ScatterFunction</code> and <code class="highlighter-rouge">GatherFunction</code>, using the <code class="highlighter-rouge">addBroadcastSetForUpdateFunction()</code> and <code class="highlighter-rouge">addBroadcastSetForMessagingFunction()</code> methods, respectively.</p>
  </li>
  <li>
    <p><strong>Number of Vertices</strong>: Accessing the total number of vertices within the iteration. This property can be set using the <code class="highlighter-rouge">setOptNumVertices()</code> method.
The number of vertices can then be accessed in the vertex update function and in the messaging function using the <code class="highlighter-rouge">getNumberOfVertices()</code> method. If the option is not set in the configuration, this method will return -1.</p>
  </li>
  <li>
    <p><strong>Degrees</strong>: Accessing the in/out degree for a vertex within an iteration. This property can be set using the <code class="highlighter-rouge">setOptDegrees()</code> method.
The in/out degrees can then be accessed in the vertex update function and in the messaging function, per vertex using the <code class="highlighter-rouge">getInDegree()</code> and <code class="highlighter-rouge">getOutDegree()</code> methods.
If the degrees option is not set in the configuration, these methods will return -1.</p>
  </li>
  <li>
    <p><strong>Messaging Direction</strong>: By default, a vertex sends messages to its out-neighbors and updates its value based on messages received from its in-neighbors. This configuration option allows users to change the messaging direction to either <code class="highlighter-rouge">EdgeDirection.IN</code>, <code class="highlighter-rouge">EdgeDirection.OUT</code>, <code class="highlighter-rouge">EdgeDirection.ALL</code>. The messaging direction also dictates the update direction which would be <code class="highlighter-rouge">EdgeDirection.OUT</code>, <code class="highlighter-rouge">EdgeDirection.IN</code> and <code class="highlighter-rouge">EdgeDirection.ALL</code>, respectively. This property can be set using the <code class="highlighter-rouge">setDirection()</code> method.</p>
  </li>
</ul>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the iteration name</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">);</span>

<span class="c1">// set the parallelism</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">);</span>

<span class="c1">// register an aggregator</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="n">LongSumAggregator</span><span class="o">());</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="n">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="n">ScatterFunction</span> <span class="o">{...}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="n">GatherFunction</span> <span class="o">{</span>

	<span class="n">LongSumAggregator</span> <span class="n">aggregator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LongSumAggregator</span><span class="o">();</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">preSuperstep</span><span class="o">()</span> <span class="o">{</span>

		<span class="c1">// retrieve the Aggregator</span>
		<span class="n">aggregator</span> <span class="o">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">);</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateVertex</span><span class="o">(</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">MessageIterator</span> <span class="n">inMessages</span><span class="o">)</span> <span class="o">{</span>

		<span class="c1">//do some computation</span>
		<span class="n">Long</span> <span class="n">partialValue</span> <span class="o">=</span> <span class="o">...</span>

		<span class="c1">// aggregate the partial value</span>
		<span class="n">aggregator</span><span class="o">.</span><span class="na">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">);</span>

		<span class="c1">// update the vertex value</span>
		<span class="n">setNewVertexValue</span><span class="o">(...);</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the iteration name
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setName</span><span class="o">(</span><span class="s">"Gelly Iteration"</span><span class="o">)</span>

<span class="c1">// set the parallelism
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setParallelism</span><span class="o">(</span><span class="mi">16</span><span class="o">)</span>

<span class="c1">// register an aggregator
</span><span class="n">parameters</span><span class="o">.</span><span class="n">registerAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>

	<span class="k">var</span> <span class="n">aggregator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LongSumAggregator</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">preSuperstep</span> <span class="o">{</span>

		<span class="c1">// retrieve the Aggregator
</span>		<span class="n">aggregator</span> <span class="k">=</span> <span class="n">getIterationAggregator</span><span class="o">(</span><span class="s">"sumAggregator"</span><span class="o">)</span>
	<span class="o">}</span>


	<span class="k">override</span> <span class="k">def</span> <span class="n">updateVertex</span><span class="o">(</span><span class="n">vertex</span><span class="k">:</span> <span class="kt">Vertex</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Long</span><span class="o">],</span> <span class="n">inMessages</span><span class="k">:</span> <span class="kt">MessageIterator</span><span class="o">[</span><span class="kt">Long</span><span class="o">])</span> <span class="o">{</span>

		<span class="c1">//do some computation
</span>		<span class="k">val</span> <span class="n">partialValue</span> <span class="k">=</span> <span class="o">...</span>

		<span class="c1">// aggregate the partial value
</span>		<span class="n">aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="o">(</span><span class="n">partialValue</span><span class="o">)</span>

		<span class="c1">// update the vertex value
</span>		<span class="n">setNewVertexValue</span><span class="o">(...)</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the degree as well as the number of vertices options.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// set the degree option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptDegrees</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="n">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="n">ScatterFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// retrieve the vertex out-degree</span>
	<span class="n">outDegree</span> <span class="o">=</span> <span class="n">getOutDegree</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="n">GatherFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration
</span><span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the number of vertices option to true
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// set the degree option to true
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setOptDegrees</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// retrieve the vertex out-degree
</span>	<span class="k">val</span> <span class="n">outDegree</span> <span class="k">=</span> <span class="n">getOutDegree</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices
</span>	<span class="k">val</span> <span class="n">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
	<span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the edge direction option. Vertices update their values to contain a list of all their in-neighbors.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">ScatterGatherConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScatterGatherConfiguration</span><span class="o">();</span>

<span class="c1">// set the messaging direction</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setDirection</span><span class="o">(</span><span class="n">EdgeDirection</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters</span>
<span class="n">DataSet</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runScatterGatherIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Messenger</span><span class="o">(),</span> <span class="k">new</span> <span class="n">VertexUpdater</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Messenger</span> <span class="kd">extends</span> <span class="n">GatherFunction</span> <span class="o">{...}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">VertexUpdater</span> <span class="kd">extends</span> <span class="n">ScatterFunction</span> <span class="o">{...}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">HashSet</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration
</span><span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ScatterGatherConfiguration</span>

<span class="c1">// set the messaging direction
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setDirection</span><span class="o">(</span><span class="nc">EdgeDirection</span><span class="o">.</span><span class="nc">IN</span><span class="o">)</span>

<span class="c1">// run the scatter-gather iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runScatterGatherIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Messenger</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VertexUpdater</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="n">getVertices</span>

<span class="c1">// user-defined functions
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">Messenger</span> <span class="k">extends</span> <span class="nc">ScatterFunction</span> <span class="o">{...}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">VertexUpdater</span> <span class="k">extends</span> <span class="nc">GatherFunction</span> <span class="o">{...}</span></code></pre></figure>

  </div>
</div>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="gather-sum-apply-iterations">Gather-Sum-Apply Iterations</h2>
<p>Like in the scatter-gather model, Gather-Sum-Apply also proceeds in synchronized iterative steps, called supersteps. Each superstep consists of the following three phases:</p>

<ul>
  <li><strong>Gather</strong>: a user-defined function is invoked in parallel on the edges and neighbors of each vertex, producing a partial value.</li>
  <li><strong>Sum</strong>: the partial values produced in the Gather phase are aggregated to a single value, using a user-defined reducer.</li>
  <li><strong>Apply</strong>:  each vertex value is updated by applying a function on the current value and the aggregated value produced by the Sum phase.</li>
</ul>

<p>Let us consider computing Single-Source-Shortest-Paths with GSA on the following graph and let vertex 1 be the source. During the <code class="highlighter-rouge">Gather</code> phase, we calculate the new candidate distances, by adding each vertex value with the edge weight. In <code class="highlighter-rouge">Sum</code>, the candidate distances are grouped by vertex ID and the minimum distance is chosen. In <code class="highlighter-rouge">Apply</code>, the newly calculated distance is compared to the current vertex value and the minimum of the two is assigned as the new value of the vertex.</p>

<p class="text-center">
    <img alt="GSA SSSP superstep 1" width="70%" src="//flink-china.org/doc/blink/fig/gelly-gsa-sssp1.png" />
</p>

<p>Notice that, if a vertex does not change its value during a superstep, it will not calculate candidate distance during the next superstep. The algorithm converges when no vertex changes value.</p>

<p>To implement this example in Gelly GSA, the user only needs to call the <code class="highlighter-rouge">runGatherSumApplyIteration</code> method on the input graph and provide the <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code> UDFs. Iteration synchronization, grouping, value updates and convergence are handled by the system:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// read the input graph</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations</span>
<span class="kt">int</span> <span class="n">maxIterations</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

<span class="c1">// Execute the GSA iteration</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
				<span class="k">new</span> <span class="nf">CalculateDistances</span><span class="o">(),</span> <span class="k">new</span> <span class="n">ChooseMinDistance</span><span class="o">(),</span> <span class="k">new</span> <span class="n">UpdateDistance</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">);</span>

<span class="c1">// Extract the vertices as the result</span>
<span class="n">DataSet</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">singleSourceShortestPaths</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getVertices</span><span class="o">();</span>


<span class="c1">// - - -  UDFs - - - //</span>

<span class="c1">// Gather</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CalculateDistances</span> <span class="kd">extends</span> <span class="n">GatherFunction</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">gather</span><span class="o">(</span><span class="n">Neighbor</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">neighbor</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">getNeighborValue</span><span class="o">()</span> <span class="o">+</span> <span class="n">neighbor</span><span class="o">.</span><span class="na">getEdgeValue</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Sum</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ChooseMinDistance</span> <span class="kd">extends</span> <span class="n">SumFunction</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">sum</span><span class="o">(</span><span class="n">Double</span> <span class="n">newValue</span><span class="o">,</span> <span class="n">Double</span> <span class="n">currentValue</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">newValue</span><span class="o">,</span> <span class="n">currentValue</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Apply</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">UpdateDistance</span> <span class="kd">extends</span> <span class="n">ApplyFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Double</span> <span class="n">newDistance</span><span class="o">,</span> <span class="n">Double</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">newDistance</span> <span class="o">&lt;</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">setResult</span><span class="o">(</span><span class="n">newDistance</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// read the input graph
</span><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// define the maximum number of iterations
</span><span class="k">val</span> <span class="n">maxIterations</span> <span class="k">=</span> <span class="mi">10</span>

<span class="c1">// Execute the GSA iteration
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">CalculateDistances</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ChooseMinDistance</span><span class="o">,</span> <span class="k">new</span> <span class="nc">UpdateDistance</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">)</span>

<span class="c1">// Extract the vertices as the result
</span><span class="k">val</span> <span class="n">singleSourceShortestPaths</span> <span class="k">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getVertices</span>


<span class="c1">// - - -  UDFs - - - //
</span>
<span class="c1">// Gather
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">CalculateDistances</span> <span class="k">extends</span> <span class="nc">GatherFunction</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">gather</span><span class="o">(</span><span class="n">neighbor</span><span class="k">:</span> <span class="kt">Neighbor</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span><span class="o">])</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
		<span class="n">neighbor</span><span class="o">.</span><span class="n">getNeighborValue</span> <span class="o">+</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">getEdgeValue</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Sum
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">ChooseMinDistance</span> <span class="k">extends</span> <span class="nc">SumFunction</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">sum</span><span class="o">(</span><span class="n">newValue</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">currentValue</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
		<span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="o">(</span><span class="n">newValue</span><span class="o">,</span> <span class="n">currentValue</span><span class="o">)</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Apply
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">UpdateDistance</span> <span class="k">extends</span> <span class="nc">ApplyFunction</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="o">{</span>

	<span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">newDistance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">oldDistance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">newDistance</span> <span class="o">&lt;</span> <span class="n">oldDistance</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">setResult</span><span class="o">(</span><span class="n">newDistance</span><span class="o">)</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>Note that <code class="highlighter-rouge">gather</code> takes a <code class="highlighter-rouge">Neighbor</code> type as an argument. This is a convenience type which simply wraps a vertex with its neighboring edge.</p>

<p>For more examples of how to implement algorithms with the Gather-Sum-Apply model, check the <a href="https://github.com/apache/flink/blob/master//flink-libraries/flink-gelly/src/main/java/org/apache/flink/graph/library/GSAPageRank.java">GSAPageRank</a> and <a href="https://github.com/apache/flink/blob/master//flink-libraries/flink-gelly/src/main/java/org/apache/flink/graph/library/GSAConnectedComponents.java">GSAConnectedComponents</a> library methods of Gelly.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="configuring-a-gather-sum-apply-iteration">Configuring a Gather-Sum-Apply Iteration</h2>
<p>A GSA iteration can be configured using a <code class="highlighter-rouge">GSAConfiguration</code> object.
Currently, the following parameters can be specified:</p>

<ul>
  <li>
    <p><strong>Name</strong>: The name for the GSA iteration. The name is displayed in logs and messages and can be specified using the <code class="highlighter-rouge">setName()</code> method.</p>
  </li>
  <li>
    <p><strong>Parallelism</strong>: The parallelism for the iteration. It can be set using the <code class="highlighter-rouge">setParallelism()</code> method.</p>
  </li>
  <li>
    <p><strong>Solution set in unmanaged memory</strong>: Defines whether the solution set is kept in managed memory (Flink’s internal way of keeping objects in serialized form) or as a simple object map. By default, the solution set runs in managed memory. This property can be set using the <code class="highlighter-rouge">setSolutionSetUnmanagedMemory()</code> method.</p>
  </li>
  <li>
    <p><strong>Aggregators</strong>: Iteration aggregators can be registered using the <code class="highlighter-rouge">registerAggregator()</code> method. An iteration aggregator combines all aggregates globally once per superstep and makes them available in the next superstep. Registered aggregators can be accessed inside the user-defined <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code>.</p>
  </li>
  <li>
    <p><strong>Broadcast Variables</strong>: DataSets can be added as <a href="//flink-china.org/doc/blink/dev/index.html#broadcast-variables">Broadcast Variables</a> to the <code class="highlighter-rouge">GatherFunction</code>, <code class="highlighter-rouge">SumFunction</code> and <code class="highlighter-rouge">ApplyFunction</code>, using the methods <code class="highlighter-rouge">addBroadcastSetForGatherFunction()</code>, <code class="highlighter-rouge">addBroadcastSetForSumFunction()</code> and <code class="highlighter-rouge">addBroadcastSetForApplyFunction</code> methods, respectively.</p>
  </li>
  <li>
    <p><strong>Number of Vertices</strong>: Accessing the total number of vertices within the iteration. This property can be set using the <code class="highlighter-rouge">setOptNumVertices()</code> method.
The number of vertices can then be accessed in the gather, sum and/or apply functions by using the <code class="highlighter-rouge">getNumberOfVertices()</code> method. If the option is not set in the configuration, this method will return -1.</p>
  </li>
  <li>
    <p><strong>Neighbor Direction</strong>: By default values are gathered from the out neighbors of the Vertex. This can be modified
using the <code class="highlighter-rouge">setDirection()</code> method.</p>
  </li>
</ul>

<p>The following example illustrates the usage of the number of vertices option.</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Double</span><span class="o">,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">GSAConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GSAConfiguration</span><span class="o">();</span>

<span class="c1">// set the number of vertices option to true</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Long</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
				<span class="k">new</span> <span class="nf">Gather</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Sum</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Apply</span><span class="o">(),</span>
			    <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">);</span>

<span class="c1">// user-defined functions</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Gather</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices</span>
	<span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sum</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Apply</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices</span>
    <span class="kt">long</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">getNumberOfVertices</span><span class="o">();</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration
</span><span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span>

<span class="c1">// set the number of vertices option to true
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setOptNumVertices</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Gather</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>

<span class="c1">// user-defined functions
</span><span class="k">final</span> <span class="k">class</span> <span class="nc">Gather</span> <span class="o">{</span>
	<span class="o">...</span>
	<span class="c1">// get the number of vertices
</span>	<span class="k">val</span> <span class="n">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Sum</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices
</span>    <span class="k">val</span> <span class="n">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">Apply</span> <span class="o">{</span>
	<span class="o">...</span>
    <span class="c1">// get the number of vertices
</span>    <span class="k">val</span> <span class="n">numVertices</span> <span class="k">=</span> <span class="n">getNumberOfVertices</span>
    <span class="o">...</span>
<span class="o">}</span></code></pre></figure>

  </div>
</div>

<p>The following example illustrates the usage of the edge direction option.</p>
<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Graph</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;,</span> <span class="n">Double</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration</span>
<span class="n">GSAConfiguration</span> <span class="n">parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GSAConfiguration</span><span class="o">();</span>

<span class="c1">// set the messaging direction</span>
<span class="n">parameters</span><span class="o">.</span><span class="na">setDirection</span><span class="o">(</span><span class="n">EdgeDirection</span><span class="o">.</span><span class="na">IN</span><span class="o">);</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters</span>
<span class="n">DataSet</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span>
			<span class="n">graph</span><span class="o">.</span><span class="na">runGatherSumApplyIteration</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">Gather</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Sum</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Apply</span><span class="o">(),</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="na">getVertices</span><span class="o">();</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span>, <span class="kt">HashSet</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>, <span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="c1">// configure the iteration
</span><span class="k">val</span> <span class="n">parameters</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GSAConfiguration</span>

<span class="c1">// set the messaging direction
</span><span class="n">parameters</span><span class="o">.</span><span class="n">setDirection</span><span class="o">(</span><span class="nc">EdgeDirection</span><span class="o">.</span><span class="nc">IN</span><span class="o">)</span>

<span class="c1">// run the gather-sum-apply iteration, also passing the configuration parameters
</span><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">runGatherSumApplyIteration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Gather</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Sum</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Apply</span><span class="o">,</span> <span class="n">maxIterations</span><span class="o">,</span> <span class="n">parameters</span><span class="o">)</span>
			<span class="o">.</span><span class="n">getVertices</span><span class="o">()</span></code></pre></figure>

  </div>
</div>
<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>

<h2 id="iteration-abstractions-comparison">Iteration Abstractions Comparison</h2>
<p>Although the three iteration abstractions in Gelly seem quite similar, understanding their differences can lead to more performant and maintainable programs.
Among the three, the vertex-centric model is the most general model and supports arbitrary computation and messaging for each vertex. In the scatter-gather model, the logic of producing messages is decoupled from the logic of updating vertex values. Thus, programs written using scatter-gather are sometimes easier to follow and maintain.
Separating the messaging phase from the vertex value update logic not only makes some programs easier to follow but might also have a positive impact on performance. Scatter-gather implementations typically have lower memory requirements, because concurrent access to the inbox (messages received) and outbox (messages to send) data structures is not required. However, this characteristic also limits expressiveness and makes some computation patterns non-intuitive. Naturally, if an algorithm requires a vertex to concurrently access its inbox and outbox, then the expression of this algorithm in scatter-gather might be problematic. Strongly Connected Components and Approximate Maximum
Weight Matching are examples of such graph algorithms. A direct consequence of this restriction is that vertices cannot generate messages and update their states in the same phase. Thus, deciding whether to propagate a message based on its content would require storing it in the vertex value, so that the gather phase has access to it, in the following iteration step. Similarly, if the vertex update logic includes computation over the values of the neighboring edges, these have to be included inside a special message passed from the scatter to the gather phase. Such workarounds often lead to higher memory requirements and non-elegant, hard to understand algorithm implementations.</p>

<p>Gather-sum-apply iterations are also quite similar to scatter-gather iterations. In fact, any algorithm which can be expressed as a GSA iteration can also be written in the scatter-gather model. The messaging phase of the scatter-gather model is equivalent to the Gather and Sum steps of GSA: Gather can be seen as the phase where the messages are produced and Sum as the phase where they are routed to the target vertex. Similarly, the value update phase corresponds to the Apply step.</p>

<p>The main difference between the two implementations is that the Gather phase of GSA parallelizes the computation over the edges, while the messaging phase distributes the computation over the vertices. Using the SSSP examples above, we see that in the first superstep of the scatter-gather case, vertices 1, 2 and 3 produce messages in parallel. Vertex 1 produces 3 messages, while vertices 2 and 3 produce one message each. In the GSA case on the other hand, the computation is parallelized over the edges: the three candidate distance values of vertex 1 are produced in parallel. Thus, if the Gather step contains “heavy” computation, it might be a better idea to use GSA and spread out the computation, instead of burdening a single vertex. Another case when parallelizing over the edges might prove to be more efficient is when the input graph is skewed (some vertices have a lot more neighbors than others).</p>

<p>Another difference between the two implementations is that the scatter-gather implementation uses a <code class="highlighter-rouge">coGroup</code> operator internally, while GSA uses a <code class="highlighter-rouge">reduce</code>. Therefore, if the function that combines neighbor values (messages) requires the whole group of values for the computation, scatter-gather should be used. If the update function is associative and commutative, then the GSA’s reducer is expected to give a more efficient implementation, as it can make use of a combiner.</p>

<p>Another thing to note is that GSA works strictly on neighborhoods, while in the vertex-centric and scatter-gather models, a vertex can send a message to any vertex, given that it knows its vertex ID, regardless of whether it is a neighbor. Finally, in Gelly’s scatter-gather implementation, one can choose the messaging direction, i.e. the direction in which updates propagate. GSA does not support this yet, so each vertex will be updated based on the values of its in-neighbors only.</p>

<p>The main differences among the Gelly iteration models are shown in the table below.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="text-left" style="width: 25%">Iteration Model</th>
      <th class="text-center">Update Function</th>
      <th class="text-center">Update Logic</th>
      <th class="text-center">Communication Scope</th>
      <th class="text-center">Communication Logic</th>
    </tr>
  </thead>
  <tbody>
 <tr>
  <td>Vertex-Centric</td>
  <td>arbitrary</td>
  <td>arbitrary</td>
  <td>any vertex</td>
  <td>arbitrary</td>
</tr>
<tr>
  <td>Scatter-Gather</td>
  <td>arbitrary</td>
  <td>based on received messages</td>
  <td>any vertex</td>
  <td>based on vertex state</td>
</tr>
<tr>
  <td>Gather-Sum-Apply</td>
  <td>associative and commutative</td>
  <td>based on neighbors' values</td>
  <td>neighborhood</td>
  <td>based on vertex state</td>
</tr>
</tbody>
</table>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//flink-china.org/doc/blink/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//flink-china.org/doc/blink/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
